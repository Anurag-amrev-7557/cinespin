import{e as Z,r as n,j as e,m as t,A as ee}from"./index-DVhI8atr.js";import{F as se,b as ie,c as te,d as ae}from"./index-CYHS-MDp.js";import{g as re,s as ne}from"./cache-BlNW5Lp3.js";const oe="92b98feaab02d1088661e456c19edb89",ce="https://api.themoviedb.org/3",v="https://image.tmdb.org/t/p",le=o=>o?o.length>200?o.substring(0,150)+"...":o:"",he=()=>{var w,b,N,_,k;const{id:o}=Z(),[i,g]=n.useState(null),[z,f]=n.useState(!0),[x,K]=n.useState(null),[p,y]=n.useState(!1),O=n.useRef(),h=n.useRef(null),[j,U]=n.useState({x:0,y:0}),Y=()=>{if(h.current){const s=h.current.getBoundingClientRect();U({x:s.left+s.width/2,y:s.top+s.height/2})}y(!0)},u=n.useCallback(()=>{y(!1)},[]);n.useEffect(()=>{const s=c=>{c.key==="Escape"&&u()};return p?document.addEventListener("keydown",s):document.removeEventListener("keydown",s),()=>{document.removeEventListener("keydown",s)}},[p,u]),n.useEffect(()=>{const s=`movie-details-${o}`;(async()=>{const d=re(s);if(d){g(d),f(!1);return}try{const l=await fetch(`${ce}/movie/${o}?api_key=${oe}&append_to_response=credits,videos,similar`);if(!l.ok)throw new Error("Failed to fetch movie details");const m=await l.json();g(m),ne(s,m)}catch(l){K(l.message)}finally{f(!1)}})()},[o]);const a={initial:{opacity:0,y:20},animate:{opacity:1,y:0,transition:{type:"spring",stiffness:300,damping:25,mass:1}},exit:{opacity:0,y:-20}};return z?e.jsx("div",{className:"movie-details-loading",children:e.jsx("p",{children:"Loading....."})}):x?e.jsx("div",{className:"movie-details-error",children:e.jsxs("p",{children:["Error: ",x]})}):i?e.jsxs(t.div,{className:"movie-details-container",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[e.jsx(t.div,{className:"movie-details-overlay",style:{backgroundImage:`url(${v}/original${i.backdrop_path})`,backgroundSize:"cover",backgroundPosition:"center"},loading:"lazy",decoding:"async",...a,children:e.jsx("div",{className:"backdrop-overlay"})}),e.jsxs(t.div,{className:"movie-content",...a,children:[e.jsxs(t.div,{className:"movie-info",...a,children:[e.jsx(t.h1,{...a,children:i.title}),e.jsxs("div",{className:"movie-meta",children:[e.jsxs(t.span,{...a,children:[e.jsx(se,{})," ",i.vote_average.toFixed(1)]}),e.jsxs(t.span,{...a,children:[e.jsx(ie,{})," ",(w=i.release_date)==null?void 0:w.split("-")[0]]}),e.jsxs(t.span,{...a,children:[e.jsx(te,{})," ",i.runtime," min"]}),e.jsxs(t.span,{...a,children:[e.jsx(ae,{})," ",i.original_language.toUpperCase()]})]}),e.jsx(t.div,{className:"movie-genres",...a,children:i.genres.map(s=>e.jsx(t.span,{className:"genre-tag",...a,children:s.name},s.id))}),e.jsxs(t.div,{className:"movie-overview",...a,children:[e.jsx("h2",{children:"Overview"}),e.jsx("p",{children:le(i.overview)}),((N=(b=i.videos)==null?void 0:b.results)==null?void 0:N.length)>0&&e.jsx(t.button,{onClick:Y,ref:h,className:"trailer-button",...a,children:"▶  Watch Trailer"})]}),((_=i.similar)==null?void 0:_.results)&&i.similar.results.length>0&&e.jsxs(t.div,{className:"similar-movies",...a,children:[e.jsx("h2",{children:"Similar Movies"}),e.jsx("div",{className:"similar-list",children:i.similar.results.map(s=>{var C,$,D,M,T,F,L,P,R,A,B,I;const c=s.genre_ids.filter(r=>i.genres.map(X=>X.id).includes(r)).length,d=parseInt((C=s.release_date)==null?void 0:C.split("-")[0])||0,l=parseInt(($=i.release_date)==null?void 0:$.split("-")[0])||0,m=1/(1+Math.abs(l-d)),G=((M=(D=i.credits)==null?void 0:D.cast)==null?void 0:M.slice(0,5).map(r=>r.id))||[],W=((F=(T=s.credits)==null?void 0:T.cast)==null?void 0:F.slice(0,5).map(r=>r.id))||[],H=G.filter(r=>W.includes(r)).length,S=(R=(P=(L=i.credits)==null?void 0:L.crew)==null?void 0:P.find(r=>r.job==="Director"))==null?void 0:R.id,E=(I=(B=(A=s.credits)==null?void 0:A.crew)==null?void 0:B.find(r=>r.job==="Director"))==null?void 0:I.id,q=S&&E&&S===E?1:0,J=(s.vote_average||0)/10,Q=(s.popularity||0)/1e3,V=c*2+m*2+H*1.5+q*3+J*1.5+Q;return{...s,relevanceScore:V}}).sort((s,c)=>c.relevanceScore-s.relevanceScore).slice(0,10).map(s=>e.jsxs(t.a,{className:"similar-movie",href:`/movie/${s.id}`,...a,children:[e.jsx("img",{src:s.poster_path?`${v}/w500${s.poster_path}`:"/default.png",alt:s.title,loading:"lazy",decoding:"async"}),e.jsx("span",{children:s.title})]},s.id))})]})]}),((k=i.credits)==null?void 0:k.cast)&&i.credits.cast.length>0&&e.jsxs(t.div,{className:"movie-cast",...a,children:[e.jsx("h2",{children:"Cast"}),e.jsx("div",{className:"cast-list",children:i.credits.cast.map(s=>e.jsxs(t.a,{className:"cast-member",href:`/cast/${s.id}`,...a,children:[e.jsx("picture",{children:e.jsx("img",{src:s.profile_path?`${v}/w500${s.profile_path}`:"/default.png",alt:s.name,loading:"lazy",decoding:"async"})}),e.jsx("span",{children:s.name})]},s.id))})]})]}),e.jsx(ee,{children:p&&e.jsx(t.div,{className:"trailer-modal-overlay",onClick:u,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.5,ease:"easeOut"},role:"dialog","aria-modal":"true",children:e.jsx(t.div,{className:"trailer-modal",onClick:s=>s.stopPropagation(),initial:{scale:.7,opacity:0,x:j.x-window.innerWidth/2,y:j.y-window.innerHeight/2},animate:{scale:1,opacity:1,x:0,y:0},exit:{scale:.7,opacity:0},transition:{scale:{type:"spring",stiffness:400,damping:20},opacity:{duration:.4},x:{type:"spring",stiffness:300,damping:30},y:{type:"spring",stiffness:300,damping:30}},ref:O,children:e.jsx("iframe",{width:"100%",height:"100%",src:`https://www.youtube.com/embed/${i.videos.results[0].key}?autoplay=1&rel=0`,title:`${i.title} Trailer`,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})})})})]}):e.jsx("div",{className:"movie-details-error",children:e.jsx("p",{children:"Movie not found"})})};export{he as default};
