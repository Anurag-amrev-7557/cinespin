import{r as i,j as e,H as Re,m as n,L as ke,c as Ne,g as Ce,h as Fe,i as De,A as oe,d as Le,f as Me,k as Ge,P as Pe,e as Ee,l as Te,n as x}from"./index-DogQIOHc.js";import{M as Be,A as ze,a as He}from"./index-BNRTKWHy.js";import{a as Ue,L as We}from"./index-BTx339qk.js";import{G as Ae,a as Ie,T as Ye,b as Oe,c as Ke}from"./index-C2xUWDSl.js";import{R as Je,a as Ve,b as qe}from"./index-DrY8N-Bt.js";import{g as Qe,s as le}from"./cache-DJHUO1lX.js";import{m as ce}from"./movieDownloadLinks-_kJNLVWA.js";const u="92b98feaab02d1088661e456c19edb89",j="https://api.themoviedb.org/3",de="https://image.tmdb.org/t/p",Xe=[{id:28,name:"Action",icon:e.jsx(We,{})},{id:35,name:"Comedy",icon:e.jsx(Le,{})},{id:18,name:"Drama",icon:e.jsx(Ae,{})},{id:27,name:"Horror",icon:e.jsx(Je,{})},{id:14,name:"Fantasy",icon:e.jsx(Me,{})},{id:878,name:"SciFi",icon:e.jsx(Ve,{})},{id:10751,name:"Family",icon:e.jsx(Be,{})},{id:10770,name:"Series",icon:e.jsx(ze,{})},{id:16,name:"Animation",icon:e.jsx(qe,{})},{id:53,name:"Thriller",icon:e.jsx(Ie,{})},{id:80,name:"Crime",icon:e.jsx(Ge,{})},{id:9648,name:"Mystery",icon:e.jsx(Pe,{})},{id:12,name:"Adventure",icon:e.jsx(Ye,{})},{id:10749,name:"Romance",icon:e.jsx(Ee,{})},{id:99,name:"Documentary",icon:e.jsx(He,{})},{id:36,name:"History",icon:e.jsx(Oe,{})},{id:10752,name:"War",icon:e.jsx(Ke,{})},{id:37,name:"Western",icon:e.jsx(Te,{})}],Ze=o=>o?o.length>200?o.substring(0,150)+"...":o:"",da=()=>{var Z,ee,ae,te,se,ie,ne,re;const[o,Y]=i.useState(null),[ea,G]=i.useState(null),[me,O]=i.useState(!1),pe=i.useRef(),[K,J]=i.useState(null),A=i.useRef(null),[V,he]=i.useState({x:0,y:0}),[ge,ue]=i.useState(localStorage.getItem("region")||"Global"),[t,P]=i.useState(null),[q,Q]=i.useState(!1),[aa,ta]=i.useState(0),[E,F]=i.useState(1);i.useEffect(()=>{const a=localStorage.getItem("randomizerState");if(a){const{genre:p,page:r}=JSON.parse(a);p&&Y(Number(p)),r&&F(Number(r))}},[]);const fe=()=>{if(A.current){const a=A.current.getBoundingClientRect();he({x:a.left+a.width/2,y:a.top+a.height/2})}O(!0)},ye=()=>{O(!1)};i.useEffect(()=>{F(1)},[o]),i.useEffect(()=>{const a=()=>{ue(localStorage.getItem("region")||"Global")};return window.addEventListener("regionChange",a),()=>{window.removeEventListener("regionChange",a)}},[]);const xe=async()=>{if(!o)return;Q(!0),G(null),P(null);const a=3,p=l=>Math.pow(2,l)*500+Math.random()*300,r=async(l=0,h=ge)=>{var k;const w=`random-${o}-page-${E}-${h}`,_=(h==null?void 0:h.toLowerCase())==="india"?"&region=IN":"";try{const S=Qe(w);if(S){P(S),F(s=>s+1);return}const y=`${j}/discover/movie?api_key=${u}&with_genres=${o}&sort_by=popularity.desc&page=${E}${_}`,{data:c}=await x.get(y);if(!((k=c==null?void 0:c.results)!=null&&k.length)){if(E>1&&l===0)return F(1),r(l+1,h);throw new Error("No results found")}const g=c.results.filter(s=>{const $=(s==null?void 0:s.adult)===!1,R=!!(s!=null&&s.poster_path),M=(s==null?void 0:s.vote_average)>=3.5,I=(s==null?void 0:s.vote_count)>=3;return $&&R&&M&&I});let d=g.length?g:c.results;d.length||(d=c.results.filter(s=>(s==null?void 0:s.poster_path)&&(s==null?void 0:s.adult)===!1),d.length||(d=c.results));const D=6.5,N=300,C=(s,$,R,M,I,we)=>{const be=new Date(we).getFullYear()||new Date().getFullYear(),_e=1/(1+Math.abs(new Date().getFullYear()-be)),Se=Math.log10(I+1);return($/($+R)*s+R/($+R)*M)*_e*Se},v=d.map(s=>{const $=s.vote_average||0,R=s.vote_count||0,M=C($,R,N,D,s.popularity||1,s.release_date);return{movie:s,weight:M}}),T=v.reduce((s,$)=>s+$.weight,0),B=Math.random()*T;let L=0,b=v[0].movie;for(const s of v)if(L+=s.weight,B<=L){b=s.movie;break}const[z,H,U,m]=await Promise.all([x.get(`${j}/movie/${b.id}?api_key=${u}`),x.get(`${j}/movie/${b.id}/credits?api_key=${u}`),x.get(`${j}/movie/${b.id}/videos?api_key=${u}`),x.get(`${j}/movie/${b.id}/similar?api_key=${u}`)]),W={...z.data,credits:H.data,videos:U.data,similar:m.data};P(W),le(w,W),F(s=>s+1)}catch(S){if(console.error(`Attempt ${l+1}:`,S.message),l<a-1){const y=p(l);setTimeout(()=>r(l+1,h),y)}else{if(h!=="Global")return console.warn("Region failed. Switching to Global..."),r(0,"Global");try{const y=`${j}/discover/movie?api_key=${u}&with_genres=${o}&sort_by=popularity.desc&page=${E}${_}`,{data:c}=await x.get(y);let g=c.results.find(d=>d==null?void 0:d.poster_path);if(!g&&c.results.length&&(g=c.results[0]),g){const[d,D,N,C]=await Promise.all([x.get(`${j}/movie/${g.id}?api_key=${u}`),x.get(`${j}/movie/${g.id}/credits?api_key=${u}`),x.get(`${j}/movie/${g.id}/videos?api_key=${u}`),x.get(`${j}/movie/${g.id}/similar?api_key=${u}`)]),v={...d.data,credits:D.data,videos:N.data,similar:C.data};P(v),le(w,v),G("Used unfiltered fallback due to repeated failures.")}else G("Completely failed to fetch any content.")}catch(y){console.error("Final fallback failed:",y),G("Completely failed to fetch any content.")}}}finally{Q(!1)}};await r()},je=async a=>{var r;const p=u;try{const h=await(await fetch(`https://api.themoviedb.org/3/movie/${a}/images?api_key=${p}&include_image_language=en,null`)).json(),w=h.logos.find(k=>k.file_path.endsWith(".webp"));if(w){J(`https://image.tmdb.org/t/p/original${w.file_path}`);return}const _=(r=h.logos[0])==null?void 0:r.file_path;_?J(`https://image.tmdb.org/t/p/original${_}`):console.log("No logo available.")}catch(l){console.error("Error fetching logo:",l)}};i.useEffect(()=>{t!=null&&t.id&&je(t.id)},[t]);const f={initial:{opacity:0,y:20},animate:{opacity:1,y:0,transition:{type:"spring",stiffness:300,damping:25,mass:1}},exit:{opacity:0,y:-20}},ve={hidden:{opacity:0,y:30},visible:{opacity:1,y:0,transition:{type:"spring",stiffness:300,damping:24,mass:1}},exit:{opacity:0,y:-20,transition:{duration:.3}}},$e=a=>{if(!a||isNaN(a))return"";const p=Math.floor(a/60),r=a%60;return`${p}h ${r}m`},X=t!=null&&t.title&&ce[Object.keys(ce).find(a=>a.toLowerCase().trim()===t.title.toLowerCase().trim())]||null;return e.jsxs(e.Fragment,{children:[e.jsxs(Re,{children:[e.jsx("title",{children:t?`${t.title} - Random Pick | Cinespin`:"Random Movie Picker - Cinespin"}),e.jsx("meta",{name:"description",content:t?`Discover "${t.title}" (${(Z=t.release_date)==null?void 0:Z.split("-")[0]}) - a ${(ee=t.genres)==null?void 0:ee.map(a=>a.name).join(", ")} movie. Picked just for you!`:"Feeling indecisive? Let Cinespin's Randomizer pick a great movie for you by genre and region!"})]}),e.jsxs(n.div,{className:"randomizer",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},...f,children:[e.jsxs(n.div,{className:"genres",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx("div",{className:"genre-title-container",children:e.jsxs("div",{className:"genre-title",children:["Genres",e.jsx("p",{children:"  Choose one genre"})]})}),e.jsx(n.div,{className:"genre-container",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},...f,children:Xe.map(a=>e.jsxs("div",{className:`genre-slide ${o===a.id?"selected":""}`,children:[e.jsx("input",{type:"radio",id:`genre-${a.id}`,checked:o===a.id,onChange:()=>Y(a.id)}),e.jsx("label",{htmlFor:`genre-${a.id}`,"aria-label":`Select ${a.name} genre`,children:e.jsxs("div",{className:"genre",children:[e.jsx("div",{className:"genre-icon",children:a.icon}),a.name]})})]},a.id))})]}),e.jsx(n.button,{className:"randomizer-button",onClick:xe,disabled:!o,initial:{scale:.8},animate:{scale:1},exit:{scale:.8},children:"Random Content"}),q&&e.jsx("div",{className:"movie-details-loading",children:e.jsx("div",{"aria-live":"assertive",role:"alert",className:"loader"})}),t&&!q&&e.jsxs(n.div,{className:"content-display",...f,children:[e.jsxs("div",{className:"movie-content",children:[e.jsx(ke,{to:`/movie/${t.id}`,className:"random-image",children:e.jsx("picture",{children:e.jsx(n.img,{src:t.poster_path?`${de}/original${t.poster_path}`:"/default.png",alt:t.title,className:"movie-poster",loading:"lazy",decoding:"async",...f})})}),e.jsxs(n.div,{className:"movie-info",...f,children:[e.jsx(n.h1,{variants:ve,children:K?e.jsx("img",{src:K,alt:"Movie Logo",className:"movie-title"}):t.title}),e.jsxs(n.div,{className:"movie-meta",...f,children:[e.jsxs("span",{children:[e.jsx(Ne,{})," ",t.vote_average.toFixed(1)]}),e.jsxs("span",{children:[e.jsx(Ce,{})," ",(ae=t.release_date)==null?void 0:ae.split("-")[0]]}),e.jsxs("span",{children:[e.jsx(Fe,{})," ",$e(t.runtime)]}),e.jsxs("span",{children:[e.jsx(De,{})," ",t.original_language.toUpperCase()]})]}),e.jsx(n.div,{className:"movie-genres",...f,children:t.genres.map(a=>e.jsx("a",{className:"genre-tag",href:`/movies?genre=${a.id}&page=1`,children:a.name},a.id))}),e.jsxs(n.div,{className:"movie-overview",...f,children:[e.jsx("h2",{children:"Overview"}),e.jsx("p",{children:Ze(t.overview)}),e.jsxs("div",{className:"download-container",children:[((se=(te=t.videos)==null?void 0:te.results)==null?void 0:se.length)>0&&e.jsx("button",{onClick:fe,ref:A,className:"trailer-button",children:"▶  Watch Trailer"}),X&&e.jsxs(n.a,{href:X,target:"_blank",rel:"noopener noreferrer",className:"trailer-button download-button",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{type:"spring",stiffness:300,damping:24,mass:1,delay:0},whileTap:{scale:.95},children:[e.jsx("span",{children:e.jsx(Ue,{})}),"  Download"]})]})]}),((ie=t.similar)==null?void 0:ie.results)&&t.similar.results.length>0&&e.jsxs(n.div,{className:"similar-movies",...f,children:[e.jsx("h2",{children:"Similar Movies"}),e.jsx(n.div,{className:"similar-list",...f,children:t.similar.results.map(a=>{var N,C,v,T,B,L,b,z,H,U;const p=a.genre_ids.filter(m=>t.genres.map(W=>W.id).includes(m)).length,r=parseInt((N=a.release_date)==null?void 0:N.split("-")[0])||0,l=parseInt((C=t.release_date)==null?void 0:C.split("-")[0])||0,h=1/(1+Math.abs(l-r)),w=(((v=t.credits)==null?void 0:v.cast)||[]).slice(0,5).map(m=>m.id),_=(((T=a.credits)==null?void 0:T.cast)||[]).slice(0,5).map(m=>m.id),k=w.filter(m=>_.includes(m)).length,S=(b=(L=(B=t.credits)==null?void 0:B.crew)==null?void 0:L.find(m=>m.job==="Director"))==null?void 0:b.id,y=(U=(H=(z=a.credits)==null?void 0:z.crew)==null?void 0:H.find(m=>m.job==="Director"))==null?void 0:U.id,c=S&&y&&S===y?1:0,g=(a.vote_average||0)/10,d=Math.log10(a.popularity||1),D=p*2+h*2+k*1.5+c*3+g*1.5+d;return{...a,relevanceScore:D}}).sort((a,p)=>p.relevanceScore-a.relevanceScore).slice(0,9).map(a=>e.jsxs("a",{className:"similar-movie",href:`/movie/${a.id}`,children:[e.jsx("picture",{children:e.jsx("img",{src:a.poster_path?`${de}/w500${a.poster_path}`:"/default.png",alt:a.title,loading:"lazy",decoding:"async"})}),e.jsx("span",{children:a.title})]},a.id))})]})]})]}),e.jsx(oe,{children:me&&((re=(ne=t==null?void 0:t.videos)==null?void 0:ne.results)==null?void 0:re.length)>0&&e.jsx(oe,{children:e.jsx(n.div,{className:"trailer-modal-overlay",onClick:ye,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},role:"dialog","aria-modal":"true",children:e.jsx(n.div,{className:"trailer-modal",onClick:a=>a.stopPropagation(),initial:{scale:.5,opacity:0,x:V.x-window.innerWidth,y:V.y-window.innerHeight},animate:{scale:1,opacity:1,x:0,y:0},exit:{scale:.5,opacity:0},transition:{duration:.3,ease:"easeOut"},ref:pe,children:e.jsx("iframe",{width:"100%",height:"100%",src:`https://www.youtube.com/embed/${t.videos.results[0].key}?autoplay=1&rel=0`,title:`${t.title} Trailer`,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})})})})})]})]})]})};export{da as default};
