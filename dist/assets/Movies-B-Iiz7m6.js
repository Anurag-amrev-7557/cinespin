import{r as t,j as e,u as J,a as W,m as p,A as L,c as q}from"./index-DVhI8atr.js";import{L as Q,S as V,M as X,A as Z}from"./index-equq3N9O.js";import{F as ee,a as se}from"./index-CYHS-MDp.js";import{c as te,R as ae,a as ie,b as ne}from"./index-B6XGXrZw.js";import{I as re}from"./index-eogdd-6s.js";const oe="92b98feaab02d1088661e456c19edb89",c=[{id:28,name:"Action",icon:e.jsx(Q,{})},{id:35,name:"Comedy",icon:e.jsx(q,{})},{id:18,name:"Drama",icon:e.jsx(se,{})},{id:27,name:"Horror",icon:e.jsx(ae,{})},{id:14,name:"Fantasy",icon:e.jsx(V,{})},{id:878,name:"SciFi",icon:e.jsx(ie,{})},{id:10751,name:"Family",icon:e.jsx(X,{})},{id:10770,name:"Series",icon:e.jsx(Z,{})},{id:16,name:"Animation",icon:e.jsx(ne,{})}],le=()=>e.jsxs("div",{className:"skeleton-genre-card",children:[e.jsx("div",{className:"skeleton-genre-icon"}),e.jsx("div",{className:"skeleton-genre-title"})]}),ue=()=>{const[o,k]=t.useState(()=>parseInt(localStorage.getItem("genre"))||c[0].id),[g,G]=t.useState([]),[m,M]=t.useState(1),[F,P]=t.useState(()=>localStorage.getItem("region")||"Global"),[$,A]=t.useState(!0),[h,ce]=t.useState(localStorage.getItem("region")||"Global"),[O,w]=t.useState(!0),[l,T]=t.useState(1),[C,B]=t.useState(1),[u,f]=t.useState(!1),[x,j]=t.useState(!1),[d,D]=t.useState("year"),[b,_]=t.useState("desc"),[H,K]=t.useState([]),I=J(),U=W(),y=parseInt(new URLSearchParams(U.search).get("genre"),10),Y=s=>{s!==o&&(localStorage.setItem("genre",s),k(s),I(`/movies?genre=${s}`),r(s,1))};t.useEffect(()=>{const s=()=>{const a=localStorage.getItem("region")||"Global";P(a)};return window.addEventListener("regionChange",s),()=>window.removeEventListener("regionChange",s)},[]);const r=t.useCallback(async(s=0,a=1)=>{w(!0);const i=`genre-${s}-page-${a}-${h}`;try{const n=h==="India"?"&region=IN&with_original_language=hi":"",v=s&&s!==0?`&with_genres=${s}`:"",N=await(await fetch(`https://api.themoviedb.org/3/discover/movie?api_key=${oe}${v}&page=${a}${n}`)).json();G(N.results),M(N.total_pages),T(a);const z=Math.floor((a-1)/5)*5+1;B(z),sessionStorage.setItem(i,JSON.stringify(N.results))}catch(n){console.error("Error fetching movies:",n)}finally{w(!1)}},[h]);t.useEffect(()=>{const s=y||parseInt(localStorage.getItem("genre"));isNaN(s)?r(c[0].id,1):(k(s),r(s,1))},[F,y]),t.useEffect(()=>{r(o,1)},[o,r]),t.useEffect(()=>{const s=parseInt(localStorage.getItem("genre"))||c[0].id;r(s,l)},[F]),t.useEffect(()=>{A(!1)},[]),t.useEffect(()=>{if(g.length>0){let s=[...g];const a=b==="asc"?1:-1;d==="year"?s.sort((i,n)=>{const v=i.release_date?parseInt(i.release_date.slice(0,4)):-1/0,E=n.release_date?parseInt(n.release_date.slice(0,4)):-1/0;return a*(v-E)}):d==="popularity"?s.sort((i,n)=>a*(n.popularity-i.popularity)):d==="rating"&&s.sort((i,n)=>a*(n.vote_average-i.vote_average)),K(s)}},[d,b,g]),t.useEffect(()=>{const s=a=>{u&&!a.target.closest(".filter-popup")&&!a.target.closest(".filter")&&f(!1),x&&!a.target.closest(".sort-popup")&&!a.target.closest(".sort")&&j(!1)};return document.addEventListener("click",s),()=>{document.removeEventListener("click",s)}},[u,x]);const S=s=>{D(s),j(!1)},R=s=>{s==="filter1"?_("asc"):s==="filter2"&&_("desc"),f(!1)};return e.jsxs("div",{className:"movies-container",children:[e.jsx(p.div,{className:"genre-container",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.3,ease:"easeOut"},children:!c.length||$?Array.from({length:c.length||9},(s,a)=>e.jsx("div",{className:"genre-slide",children:e.jsx(le,{})},a)):c.map(s=>e.jsx("div",{className:"genre-slide",children:e.jsxs("div",{className:`genre ${y===s.id?"active":""}`,onClick:()=>Y(s.id),children:[e.jsx("div",{className:"genre-icon",children:s.icon}),s.name]})},s.id))}),e.jsxs("div",{className:"movies-list",children:[e.jsxs("div",{className:"sorting-container",children:[e.jsx("div",{className:"filter",onClick:()=>f(s=>!s),"aria-label":"Toggle filter options",children:e.jsx(te,{})}),e.jsx("div",{className:"sort",onClick:()=>j(s=>!s),"aria-label":"Toggle sort options",children:e.jsx(re,{})})]}),e.jsx(L,{children:u&&e.jsxs(p.div,{className:"popup-menu filter-popup",initial:{opacity:0,scale:.8,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:-10},transition:{type:"spring",stiffness:300,damping:30},children:[e.jsx("p",{onClick:()=>R("filter1"),children:"Ascending Order"}),e.jsx("div",{className:"liner"}),e.jsx("p",{onClick:()=>R("filter2"),children:"Descending Order"})]})}),e.jsx(L,{children:x&&e.jsxs(p.div,{className:"popup-menu sort-popup",initial:{opacity:0,scale:.8,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:-10},transition:{type:"spring",stiffness:300,damping:30},children:[e.jsx("p",{onClick:()=>S("year"),children:"Sort by Year"}),e.jsx("div",{className:"liner"}),e.jsx("p",{onClick:()=>S("popularity"),children:"Sort by Popularity"}),e.jsx("div",{className:"liner"}),e.jsx("p",{onClick:()=>S("rating"),children:"Sort by Rating"})]})}),O?e.jsx("div",{className:"loading",children:"Loading..."}):e.jsx("div",{className:"movie-grid",children:H.map((s,a)=>{var i;return e.jsxs(p.div,{className:"movie-card",onClick:()=>I(`/movie/${s.id}`),initial:{opacity:0,y:30,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:30,scale:.95},whileHover:{scale:1,y:-5},transition:{duration:.25,ease:[.4,0,.2,1]},children:[e.jsx("picture",{children:e.jsx("img",{loading:"lazy",decoding:"async",src:s.poster_path?`https://image.tmdb.org/t/p/w500${s.poster_path}`:"/default.png",alt:s.title,className:"movie-poster"})}),e.jsx("span",{className:"movie-title",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:s.title.split(" ").slice(0,3).join(" ")}),e.jsxs("div",{className:"movie-details",children:[e.jsxs("span",{children:[e.jsx(ee,{className:"movie-star"})," ",s.vote_average.toFixed(1)]}),e.jsx("span",{className:"gap",children:" 〡 "}),e.jsx("span",{children:(i=s.release_date)==null?void 0:i.split("-")[0]}),s.runtime&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"gap",children:" 〡 "}),e.jsxs("span",{children:[s.runtime," min"]})]})]})]},s.id)})}),m>1&&e.jsxs("div",{className:"pagination-controls",children:[e.jsx("button",{onClick:()=>r(o,l-1),disabled:l===1,children:"Prev"}),Array.from({length:Math.min(5,m-C+1)},(s,a)=>{const i=C+a;return e.jsx("button",{onClick:()=>r(o,i),className:l===i?"active-page":"",children:i},i)}),e.jsx("button",{onClick:()=>r(o,l+1),disabled:l>=m,children:"Next"})]})]})]})};export{ue as default};
