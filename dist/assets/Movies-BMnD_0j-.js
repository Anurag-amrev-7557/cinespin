import{r as i,j as e,u as Q,a as V,m as g,A as L,c as X}from"./index-BwEYW-Gc.js";import{L as Z,S as ee,M as se,A as te}from"./index-D7unnDWH.js";import{F as ae,a as ie}from"./index-BN6NO_kq.js";import{c as re,R as ne,a as oe,b as le}from"./index-CM4RPr90.js";import{g as ce,s as de}from"./cache-DJHUO1lX.js";import{I as pe}from"./index-mfDr7Uzw.js";const me="92b98feaab02d1088661e456c19edb89",h=[{id:28,name:"Action",icon:e.jsx(Z,{})},{id:35,name:"Comedy",icon:e.jsx(X,{})},{id:18,name:"Drama",icon:e.jsx(ie,{})},{id:27,name:"Horror",icon:e.jsx(ne,{})},{id:14,name:"Fantasy",icon:e.jsx(ee,{})},{id:878,name:"SciFi",icon:e.jsx(oe,{})},{id:10751,name:"Family",icon:e.jsx(se,{})},{id:10770,name:"Series",icon:e.jsx(te,{})},{id:16,name:"Animation",icon:e.jsx(le,{})}],ge=()=>e.jsxs("div",{className:"skeleton-genre-card",children:[e.jsx("div",{className:"skeleton-genre-icon"}),e.jsx("div",{className:"skeleton-genre-title"})]}),ve=()=>{const[c,_]=i.useState(()=>parseInt(localStorage.getItem("genre"))||h[0].id),[u,j]=i.useState([]),[v,S]=i.useState(1),[G,T]=i.useState(!0),[N,O]=i.useState(()=>localStorage.getItem("region")||"Global"),[D,P]=i.useState(!0),[d,o]=i.useState(1),[A,w]=i.useState(1),[I,k]=i.useState(!1),[C,F]=i.useState(!1),[f,B]=i.useState("year"),[M,E]=i.useState("desc"),[H,K]=i.useState([]),R=Q(),U=V(),Y=parseInt(new URLSearchParams(U.search).get("genre"),10),z=s=>{s!==c&&(localStorage.setItem("genre",s),localStorage.setItem("currentPage",1),o(1),_(s),R(`/movies?genre=${s}`),l(s,1))},l=i.useCallback(async(s=0,t=1)=>{P(!0);const a=typeof s=="number"&&!isNaN(s)?s:0,r=typeof t=="number"&&t>0?t:1,x=`genre-${a}-page-${r}-${N}`;try{const n=ce(x);if(n&&Array.isArray(n.results)){j(n.results);const m=parseInt((n||p).total_pages,10);S(!isNaN(m)&&m>0?m:1),r>m?o(1):o(r),w(Math.floor((r-1)/5)*5+1);return}const W=N==="India"?"&region=IN&with_original_language=hi":"",q=a&&a!==0?`&with_genres=${a}`:"",J=`https://api.themoviedb.org/3/discover/movie?api_key=${me}${q}&page=${r}${W}`,y=await fetch(J);if(!y.ok){const m=`TMDB API error: ${y.status} ${y.statusText}`;throw new Error(m)}const p=await y.json();if(!Array.isArray(p.results))throw new Error("Invalid data structure from TMDB API.");j(p.results),S(Number.isInteger(p.total_pages)?p.total_pages:1),o(r),localStorage.setItem("currentPage",r),w(Math.floor((r-1)/5)*5+1),de(x,p)}catch(n){console.error("Error fetching movies:",n),j([]),S(1),o(1),w(1)}finally{P(!1)}},[N]);i.useEffect(()=>{const s=()=>{const t=localStorage.getItem("region")||"Global";O(t),o(1),localStorage.setItem("currentPage",1),l(c,1)};return window.addEventListener("regionChange",s),()=>window.removeEventListener("regionChange",s)},[c,d,l]),i.useEffect(()=>{const s=parseInt(localStorage.getItem("genre"))||h[0].id,t=parseInt(localStorage.getItem("currentPage"),10)||1;_(s),o(t),l(s,t)},[]),i.useEffect(()=>{T(!1)},[]),i.useEffect(()=>{if(u.length>0){let s=[...u];const t=M==="asc"?1:-1;f==="year"?s.sort((a,r)=>{const x=a.release_date?parseInt(a.release_date.slice(0,4)):-1/0,n=r.release_date?parseInt(r.release_date.slice(0,4)):-1/0;return t*(x-n)}):f==="popularity"?s.sort((a,r)=>t*(r.popularity-a.popularity)):f==="rating"&&s.sort((a,r)=>t*(r.vote_average-a.vote_average)),K(s)}},[f,M,u]),i.useEffect(()=>{const s=t=>{I&&!t.target.closest(".filter-popup")&&!t.target.closest(".filter")&&k(!1),C&&!t.target.closest(".sort-popup")&&!t.target.closest(".sort")&&F(!1)};return document.addEventListener("click",s),()=>{document.removeEventListener("click",s)}},[I,C]);const b=s=>{B(s),F(!1)},$=s=>{s==="filter1"?E("asc"):s==="filter2"&&E("desc"),k(!1)};return e.jsxs("div",{className:"movies-container",children:[e.jsx(g.div,{className:"genre-container",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.3,ease:"easeOut"},children:!h.length||G?Array.from({length:h.length||9},(s,t)=>e.jsx("div",{className:"genre-slide",children:e.jsx(ge,{})},t)):h.map(s=>e.jsx("div",{className:"genre-slide",children:e.jsxs("div",{className:`genre ${Y===s.id?"active":""}`,onClick:()=>z(s.id),children:[e.jsx("div",{className:"genre-icon",children:s.icon}),s.name]})},s.id))}),e.jsxs("div",{className:"movies-list",children:[e.jsxs("div",{className:"sorting-container",children:[e.jsx("div",{className:"filter",onClick:()=>k(s=>!s),"aria-label":"Toggle filter options",children:e.jsx(re,{})}),e.jsx("div",{className:"sort",onClick:()=>F(s=>!s),"aria-label":"Toggle sort options",children:e.jsx(pe,{})})]}),e.jsx(L,{children:I&&e.jsxs(g.div,{className:"popup-menu filter-popup",initial:{opacity:0,scale:.8,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:-10},transition:{type:"spring",stiffness:300,damping:30},children:[e.jsx("p",{onClick:()=>$("filter1"),children:"Ascending Order"}),e.jsx("div",{className:"liner"}),e.jsx("p",{onClick:()=>$("filter2"),children:"Descending Order"})]})}),e.jsx(L,{children:C&&e.jsxs(g.div,{className:"popup-menu sort-popup",initial:{opacity:0,scale:.8,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:-10},transition:{type:"spring",stiffness:300,damping:30},children:[e.jsx("p",{onClick:()=>b("year"),children:"Sort by Year"}),e.jsx("div",{className:"liner"}),e.jsx("p",{onClick:()=>b("popularity"),children:"Sort by Popularity"}),e.jsx("div",{className:"liner"}),e.jsx("p",{onClick:()=>b("rating"),children:"Sort by Rating"})]})}),D?e.jsx("div",{className:"loading"}):e.jsx("div",{className:"movie-grid",children:H.map((s,t)=>{var a;return e.jsxs(g.div,{className:"movie-card",onClick:()=>R(`/movie/${s.id}`),initial:{opacity:0,y:30,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:30,scale:.95},whileHover:{scale:1,y:-5},transition:{duration:.7,ease:[.4,0,.2,1]},children:[e.jsx("picture",{children:e.jsx("img",{loading:"lazy",decoding:"async",src:s.poster_path?`https://image.tmdb.org/t/p/w500${s.poster_path}`:"/default.png",alt:s.title,className:"movie-poster"})}),e.jsx("span",{className:"movie-title",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:s.title.split(" ").slice(0,3).join(" ")}),e.jsxs("div",{className:"movie-details",children:[e.jsxs("span",{children:[e.jsx(ae,{className:"movie-star"})," ",s.vote_average.toFixed(1)]}),e.jsx("span",{className:"gap",children:" 〡 "}),e.jsx("span",{children:(a=s.release_date)==null?void 0:a.split("-")[0]}),s.runtime&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"gap",children:" 〡 "}),e.jsxs("span",{children:[s.runtime," min"]})]})]})]},s.id)})}),(v>1||u.length>0)&&e.jsxs("div",{className:"pagination-controls",children:[e.jsx("button",{onClick:()=>l(c,d-1),disabled:d===1,children:"Prev"}),[...Array(Math.min(5,v-A+1))].map((s,t)=>{const a=A+t;return e.jsx(g.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>l(c,a),className:d===a?"active-page":"",children:a},a)}),e.jsx("button",{onClick:()=>l(c,d+1),disabled:d>=v,children:"Next"})]})]})]})};export{ve as default};
