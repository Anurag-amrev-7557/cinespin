import{r as i,j as s,u as oe,a as ce,H as le,m as g,I as de,A as M,c as me,F as ge,b as pe,d as he,f as ue,k as fe,P as xe,e as ve,l as je}from"./index-BpWArnGf.js";import{M as ye,A as Se,a as we}from"./index-Ccu0_b7r.js";import{L as Ne}from"./index--iGkVqAn.js";import{G as be,a as _e,T as Pe,b as Ce,c as Fe}from"./index-DmXE6_-R.js";import{c as Ie,R as ke,a as Ee,b as $e}from"./index-D2To4wpB.js";import{g as Me,s as Re}from"./cache-DJHUO1lX.js";/* empty css               */const K="92b98feaab02d1088661e456c19edb89",m=[{id:28,name:"Action",icon:s.jsx(Ne,{})},{id:35,name:"Comedy",icon:s.jsx(he,{})},{id:18,name:"Drama",icon:s.jsx(be,{})},{id:27,name:"Horror",icon:s.jsx(ke,{})},{id:14,name:"Fantasy",icon:s.jsx(ue,{})},{id:878,name:"SciFi",icon:s.jsx(Ee,{})},{id:10751,name:"Family",icon:s.jsx(ye,{})},{id:10770,name:"Series",icon:s.jsx(Se,{})},{id:16,name:"Animation",icon:s.jsx($e,{})},{id:53,name:"Thriller",icon:s.jsx(_e,{})},{id:80,name:"Crime",icon:s.jsx(fe,{})},{id:9648,name:"Mystery",icon:s.jsx(xe,{})},{id:12,name:"Adventure",icon:s.jsx(Pe,{})},{id:10749,name:"Romance",icon:s.jsx(ve,{})},{id:99,name:"Documentary",icon:s.jsx(we,{})},{id:36,name:"History",icon:s.jsx(Ce,{})},{id:10752,name:"War",icon:s.jsx(Fe,{})},{id:37,name:"Western",icon:s.jsx(je,{})}],Ge=()=>s.jsxs("div",{className:"skeleton-genre-card",children:[s.jsx("div",{className:"skeleton-genre-icon"}),s.jsx("div",{className:"skeleton-genre-title"})]}),Ve=()=>{var U,W,V;const[n,R]=i.useState(()=>parseInt(localStorage.getItem("genre"))||m[0].id),[f,j]=i.useState([]),[y,S]=i.useState(1),[z,Y]=i.useState(!0),[p,G]=i.useState(()=>localStorage.getItem("region")||"Global"),[q,L]=i.useState(!0),[o,w]=i.useState(localStorage.getItem("currentPage")),[Le,Ae]=i.useState(parseInt(localStorage.getItem("currentPage"))||1),[A,N]=i.useState(3),[b,_]=i.useState(!1),[P,C]=i.useState(!1),[x,J]=i.useState("year"),[T,D]=i.useState("desc"),[Q,X]=i.useState([]),F=oe(),I=ce(),Z={hidden:{opacity:0,y:40,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{type:"spring",stiffness:240,damping:20,mass:.8}},exit:{opacity:0,y:30,scale:.95,transition:{duration:.3}}},H={hidden:{},visible:{transition:{staggerChildren:.07,delayChildren:.2}}},O={hidden:{opacity:0,scale:.9,y:-10},visible:{opacity:1,scale:1,y:0,transition:{type:"spring",stiffness:260,damping:22}},exit:{opacity:0,scale:.9,y:-10,transition:{duration:.2}}};i.useEffect(()=>{const e=new URLSearchParams(I.search),t=parseInt(e.get("genre"),10),a=parseInt(e.get("page"),10),r=t||m[0].id,h=a||parseInt(localStorage.getItem("currentPage"),10)||1;R(r),c(r,h)},[I.search]);const ee=e=>{e!==n&&(localStorage.setItem("genre",e),localStorage.setItem("selectedGenre",e),localStorage.setItem("currentPage",o),R(e),F(`/series?genre=${e}&page=${o}`),c(e,o))},se=async e=>{try{const t=await fetch(`https://api.themoviedb.org/3/tv/${e}?api_key=${K}`);if(!t.ok)throw new Error("Failed to fetch movie details");return await t.json()}catch(t){return console.error("Error fetching movie details:",t),null}},c=async(e=0,t=1)=>{L(!0);const a=typeof e=="number"&&!isNaN(e)?e:0,r=typeof t=="number"&&t>0?t:1,h=`genre-${a}-page-${r}-region-${p}`;try{const l=Me(h);if(l&&Array.isArray(l.results)){j(l.results);const d=parseInt((l||u).total_pages,10);S(!isNaN(d)&&d>0?d:1),N(Math.floor((r-1)/5)*5+1);return}const ae=p==="India"?"&region=IN&with_original_language=hi":"",ie=a&&a!==0?`&with_genres=${a}`:"",re=`https://api.themoviedb.org/3/discover/tv?api_key=${K}${ie}&page=${r}${ae}`,v=await fetch(re);if(!v.ok){const d=`TMDB API error: ${v.status} ${v.statusText}`;throw new Error(d)}const u=await v.json();if(!Array.isArray(u.results))throw new Error("Invalid data structure from TMDB API.");const ne=await Promise.all((u.results||[]).map(async d=>{const $=await se(d.id);return{...d,runtime:($==null?void 0:$.runtime)||null}}));j(ne),S(Number.isInteger(u.total_pages)?u.total_pages:1),N(Math.floor((r-1)/5)*5+1),F(`/series?genre=${a}&page=${r}`,{replace:!0}),Re(h,u)}catch(l){console.error("Error fetching movies:",l),j([]),S(1),N(1)}finally{L(!1)}};i.useEffect(()=>{c(n,1)},[p]),i.useEffect(()=>{const e=()=>{const t=localStorage.getItem("region")||"Global";if(t!==p){G(t);const a=parseInt(localStorage.getItem("currentPage"),10),r=!isNaN(a)&&a>0?a:1;c(n,r)}};return window.addEventListener("regionChange",e),window.addEventListener("storage",e),()=>{window.removeEventListener("regionChange",e),window.removeEventListener("storage",e)}},[n,p]),i.useEffect(()=>{const e=t=>{if(t.key==="region"){const a=t.newValue||"Global";G(a),c(n,1)}};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}},[n,c]),i.useEffect(()=>{if(f.length>0){let e=[...f];const t=T==="asc"?1:-1;x==="year"?e.sort((a,r)=>{const h=a.first_air_date?parseInt(a.first_air_date.slice(0,4)):a.release_date?parseInt(a.release_date.slice(0,4)):-1/0,l=r.first_air_date?parseInt(r.first_air_date.slice(0,4)):r.release_date?parseInt(r.release_date.slice(0,4)):-1/0;return t*(h-l)}):x==="popularity"?e.sort((a,r)=>t*(r.popularity-a.popularity)):x==="rating"&&e.sort((a,r)=>t*(r.vote_average-a.vote_average)),X(e)}},[x,T,f]),i.useEffect(()=>{const e=t=>{b&&!t.target.closest(".filter-popup")&&!t.target.closest(".filter")&&_(!1),P&&!t.target.closest(".sort-popup")&&!t.target.closest(".sort")&&C(!1)};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[b,P]);const k=e=>{J(e),C(!1)},B=e=>{e==="filter1"?D("asc"):e==="filter2"&&D("desc"),_(!1)};i.useEffect(()=>{c(n,1)},[n,p]),i.useEffect(()=>{Y(!1)},[]),i.useEffect(()=>{const e=parseInt(localStorage.getItem("currentPage"),10)||1;w(e)},[]),i.useEffect(()=>{localStorage.setItem("currentPage",o)},[o]);const te=e=>{if(!e||isNaN(e))return"";const t=Math.floor(e/60),a=e%60;return`${t}h ${a}m`};i.useEffect(()=>{const e=new URLSearchParams(window.location.search),t=parseInt(e.get("page"),10)||1;w(t)},[I.search]),i.useEffect(()=>{c(n,o)},[o,n]);const E=e=>{w(e);const t=new URLSearchParams(window.location.search);t.set("page",e),window.history.replaceState(null,"","?"+t.toString()),c(n,e)};return s.jsxs(s.Fragment,{children:[n&&s.jsxs(le,{children:[s.jsx("title",{children:`Browse ${((U=m.find(e=>e.id===n))==null?void 0:U.name)||"Movies"} Movies - Cinespin`}),s.jsx("meta",{name:"description",content:`Explore the best ${((W=m.find(e=>e.id===n))==null?void 0:W.name)||"movies"} movies by genre. Discover new favorites with Cinespin!`})]}),s.jsxs("div",{className:"movies-container",children:[s.jsx(g.div,{className:"genre-container",variants:H,initial:"hidden",animate:"visible",children:!m.length||z?Array.from({length:m.length||18},(e,t)=>s.jsx("div",{className:"genre-slide",children:s.jsx(Ge,{})},t)):m.map(e=>s.jsx("div",{className:"genre-slide",children:s.jsxs("div",{className:`genre ${n===e.id?"active":""}`,onClick:()=>ee(e.id),children:[s.jsx("div",{className:"genre-icon",children:e.icon}),e.name]})},e.id))}),s.jsxs("div",{className:"big-sorting-container",children:[s.jsx("div",{className:"selected-genre-mobile",children:s.jsx("span",{className:"selected-genre-title",children:window.innerWidth<=450&&((V=m.find(e=>e.id===n))==null?void 0:V.name)})}),s.jsxs("div",{className:"sorting-container",children:[s.jsx("div",{className:"filter",onClick:()=>_(e=>!e),"aria-label":"Toggle filter options",children:s.jsx(Ie,{})}),s.jsx("div",{className:"sort",onClick:()=>C(e=>!e),"aria-label":"Toggle sort options",children:s.jsx(de,{})})]}),s.jsx(M,{children:b&&s.jsxs(g.div,{className:"popup-menu filter-popup",variants:O,initial:"hidden",animate:"visible",exit:"exit",children:[s.jsx("p",{onClick:()=>B("filter1"),children:"Descending Order"}),s.jsx("div",{className:"liner"}),s.jsx("p",{onClick:()=>B("filter2"),children:"Ascending Order"})]})}),s.jsx(M,{children:P&&s.jsxs(g.div,{className:"popup-menu sort-popup",variants:O,initial:"hidden",animate:"visible",exit:"exit",children:[s.jsx("p",{onClick:()=>k("year"),children:"Sort by Year"}),s.jsx("div",{className:"liner"}),s.jsx("p",{onClick:()=>k("popularity"),children:"Sort by Popularity"}),s.jsx("div",{className:"liner"}),s.jsx("p",{onClick:()=>k("rating"),children:"Sort by Rating"})]})})]}),s.jsxs("div",{className:"movies-list",children:[q?s.jsx("div",{className:"movie-details-loading",children:s.jsx("div",{"aria-live":"assertive",role:"alert",className:"loader"})}):s.jsx(M,{mode:"wait",children:s.jsx(g.div,{className:"movie-grid",variants:H,initial:"hidden",animate:"visible",exit:"hidden",children:Q.map(e=>{var t,a;return s.jsxs(g.div,{layout:!0,className:"movie-card",onClick:()=>F(`/series/${e.id}`),whileHover:{scale:1.03,y:-3,transition:{ease:"easeOut"}},variants:Z,children:[s.jsxs("picture",{children:[e.poster_path&&s.jsx("source",{srcSet:`https://image.tmdb.org/t/p/w500${e.poster_path.endsWith(".webp")?e.poster_path:`${e.poster_path}.webp`}`,type:"image/webp"}),s.jsx(g.img,{loading:"lazy",decoding:"async",src:e.poster_path?`https://image.tmdb.org/t/p/w500${e.poster_path}`:"/default.png",alt:e.name||e.title,className:"movie-poster",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4,ease:"easeOut"}})]}),s.jsx("span",{className:"movie-title",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:(t=e.name||e.title)==null?void 0:t.split(" ").slice(0,3).join(" ")}),s.jsxs("div",{className:"movie-details",children:[s.jsxs("span",{children:[s.jsx(me,{className:"movie-star"})," ",e.vote_average.toFixed(1)]}),s.jsx("span",{className:"gap",children:" 〡 "}),s.jsx("span",{children:(a=e.first_air_date||e.release_date)==null?void 0:a.split("-")[0]}),e.runtime&&s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"gap",children:" 〡 "}),s.jsx("span",{children:te(e.runtime)})]})]})]},e.id)})})}),(y>1||f.length>0)&&s.jsxs("div",{className:"pagination-controls",children:[s.jsx("button",{onClick:()=>E(o-1),disabled:o===1,children:s.jsx(ge,{})}),[...Array(Math.min(5,y-A+1))].map((e,t)=>{const a=A+t;return s.jsx(g.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>E(a),className:o===a?"active-page":"",children:a},a)}),s.jsx("button",{onClick:()=>E(o+1),disabled:o>=y,children:s.jsx(pe,{})})]})]})]})]})};export{Ve as default};
