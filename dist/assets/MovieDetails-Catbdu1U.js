import{G as $e,o as Ce,u as Ne,a as Re,r,j as e,m as o,H as Le,c as Ue,g as Se,h as De,i as Ee,p as Te,A as Me}from"./index-D0-cOv4n.js";import{g as Pe,s as ue}from"./cache-DJHUO1lX.js";import{m as ve}from"./movieDownloadLinks-_kJNLVWA.js";import{s as Ie}from"./MovieDetails-4dli7IQi.js";function Be(l){return $e({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"},child:[]},{tag:"polyline",attr:{points:"7 10 12 15 17 10"},child:[]},{tag:"line",attr:{x1:"12",y1:"15",x2:"12",y2:"3"},child:[]}]})(l)}const y="92b98feaab02d1088661e456c19edb89",w="https://api.themoviedb.org/3",N="https://image.tmdb.org/t/p",fe=(l,u=200)=>l&&l.length>u?l.slice(0,u)+"...":l||"",Oe=()=>{var O,K,z,Y,q,J,Q;const{id:l}=Ce(),u=Ne(),S=Re(),D=r.useMemo(()=>new URLSearchParams(S.search),[S.search]).get("page")||1,ge=r.useRef(null),E=r.useRef(null),[a,j]=r.useState(null),[T,M]=r.useState(null),[ye,P]=r.useState(!0),[we,I]=r.useState(!0),[B,xe]=r.useState(null),[F,R]=r.useState(!1),[je,A]=r.useState(!1),[L,W]=r.useState(!1),[H,_e]=r.useState({x:0,y:0}),_=r.useMemo(()=>`movie-details-${l}`,[l]),ke=()=>{var t,s,c,p;if(window.innerWidth<=450){const i=(c=(s=(t=a==null?void 0:a.videos)==null?void 0:t.results)==null?void 0:s[0])==null?void 0:c.key;if(i){const h=`youtube://www.youtube.com/watch?v=${i}`,v=`https://www.youtube.com/watch?v=${i}`,f=window.open(h,"_blank");setTimeout(()=>{f&&(f.location.href=v)},500)}}else{const i=(p=E.current)==null?void 0:p.getBoundingClientRect();i&&_e({x:i.left+i.width/2,y:i.top+i.height/2}),W(!0)}},U=r.useCallback(()=>W(!1),[]);r.useEffect(()=>{const t=s=>s.key==="Escape"&&U();return L&&document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[L,U]),r.useEffect(()=>{const t=setTimeout(()=>{document.body.style.background="black"},1e3);return()=>{clearTimeout(t),document.body.style.background=""}},[]),r.useEffect(()=>{window.scrollTo(0,0)},[]),r.useEffect(()=>{(async()=>{var c;const s=Pe(_);if(s){setTimeout(()=>{j(s),P(!1)},200);return}try{const p=await fetch(`${w}/movie/${l}?api_key=${y}&append_to_response=credits,videos`);if(!p.ok)throw new Error("Failed to fetch movie details");const i=await p.json();if(j(i),(c=i.belongs_to_collection)!=null&&c.id)try{const v=await(await fetch(`${w}/collection/${i.belongs_to_collection.id}?api_key=${y}`)).json(),x=(await Promise.all((v.parts||[]).filter(m=>m.id!==i.id).map(async m=>await(await fetch(`${w}/movie/${m.id}?api_key=${y}&append_to_response=credits`)).json()))).filter(m=>m.release_date).sort((m,g)=>{var $,C;const k=parseInt(($=m.release_date)==null?void 0:$.split("-")[0])||0,b=parseInt((C=g.release_date)==null?void 0:C.split("-")[0])||0;return k===b?(g.vote_average||0)-(m.vote_average||0):b-k});i.similar={results:x},j({...i}),ue(_,{...i});return}catch(h){console.error("Failed to fetch collection parts:",h)}try{const v=await(await fetch(`${w}/movie/${l}/similar?api_key=${y}`)).json(),f=await Promise.all((v.results||[]).slice(0,10).map(async x=>await(await fetch(`${w}/movie/${x.id}?api_key=${y}&append_to_response=credits`)).json()));i.similar={results:f},j({...i}),ue(_,{...i})}catch(h){console.error("Error fetching similar movies with details:",h)}}catch(p){xe(p.message)}finally{P(!1)}})()},[_]),r.useEffect(()=>{M(null),I(!0),R(!1),A(!0),(async()=>{try{const c=await(await fetch(`${w}/movie/${l}/images?api_key=${y}&include_image_language=en,null`)).json(),p=c.logos.find(i=>i.file_path.endsWith(".webp"))||c.logos[0];p&&M(`${N}/original${p.file_path}`),R(!0)}catch(s){console.error("Error fetching logo:",s),R(!0)}finally{I(!1)}})()},[l]),r.useEffect(()=>{F&&(a!=null&&a.title)&&A(!0)},[F,a]);const G=r.useMemo(()=>{const t=Object.keys(ve).find(s=>{var c;return s.toLowerCase().trim()===((c=a==null?void 0:a.title)==null?void 0:c.toLowerCase().trim())});return t?ve[t]:null},[a]);r.useMemo(()=>(a==null?void 0:a.title)&&Ie[a.title],[a]);const n={container:{hidden:{},visible:{transition:{staggerChildren:.1,delayChildren:.3}}},fadeUp:{hidden:{opacity:0,y:30},visible:{opacity:1,y:0,transition:{type:"spring",stiffness:300,damping:24}},exit:{opacity:0,y:-20,transition:{duration:.3}}},overlay:{hidden:{opacity:0},visible:{opacity:1,transition:{duration:.4}},exit:{opacity:0,transition:{duration:.3}}},modal:(t,s)=>({hidden:{scale:.7,opacity:0,x:t,y:s},visible:{scale:1,opacity:1,x:0,y:0,transition:{type:"spring",stiffness:400,damping:25}},exit:{scale:.7,opacity:0,transition:{duration:.3,ease:"easeInOut"}}})};return ye||!a?e.jsx("div",{className:"movie-details-loading",children:e.jsx("div",{className:"loader","aria-live":"assertive",role:"alert"})}):B?e.jsx("div",{className:"movie-details-error",children:e.jsxs("p",{children:["Error: ",B]})}):e.jsxs(o.div,{className:"movie-details-container",variants:n.container,initial:"hidden",animate:"visible",exit:"exit",children:[e.jsxs(Le,{children:[e.jsxs("title",{children:[a.title," - Movie Details"]}),e.jsx("meta",{name:"description",content:fe(a.overview)})]}),e.jsx(o.div,{className:"movie-details-overlay",style:{backgroundImage:`url(${N}/original${a.backdrop_path})`},decoding:"async",variants:n.fadeUp,children:e.jsx("div",{className:"backdrop-overlay"})}),e.jsxs(o.div,{className:"movie-content",variants:n.fadeUp,children:[e.jsxs(o.div,{className:"movie-info",variants:n.fadeUp,children:[e.jsx(o.h1,{variants:n.fadeUp,children:we?e.jsx("div",{className:"loading-logo-placeholder"}):T?e.jsx("img",{src:T,alt:"Movie Logo",className:"movie-title"}):je?e.jsx("span",{className:"movie-title-text",children:a.title}):null}),e.jsxs("div",{className:"movie-meta",children:[e.jsxs(o.span,{variants:n.fadeUp,children:[e.jsx(Ue,{})," ",a.vote_average.toFixed(1)]}),e.jsxs(o.span,{variants:n.fadeUp,children:[e.jsx(Se,{})," ",(O=a.release_date)==null?void 0:O.split("-")[0]]}),a.runtime&&e.jsxs(o.span,{variants:n.fadeUp,children:[e.jsx(De,{})," ",Math.floor(a.runtime/60),"h ",a.runtime%60,"m"]}),e.jsxs(o.span,{variants:n.fadeUp,children:[e.jsx(Ee,{})," ",a.original_language.toUpperCase()]})]}),e.jsx(o.div,{className:"movie-genres",variants:n.fadeUp,children:a.genres.map(t=>e.jsx(o.div,{className:"genre-tag",role:"button",tabIndex:0,onClick:()=>u(`/movies?genre=${t.id}&page=${D}`),onKeyDown:s=>{s.key==="Enter"&&u(`/movies?genre=${t.id}&page=${D}`)},whileHover:{scale:1.05},whileTap:{scale:.95},children:t.name},t.id))}),e.jsxs(o.div,{className:"movie-overview",variants:n.fadeUp,children:[e.jsx("h2",{children:"Overview"}),e.jsx("p",{children:fe(a.overview)}),e.jsxs("div",{className:"download-container",children:[((z=(K=a.videos)==null?void 0:K.results)==null?void 0:z.length)>0&&e.jsxs(o.a,{onClick:ke,ref:E,className:"trailer-button",animate:{opacity:1,y:0},whileTap:{scale:.8},children:[e.jsx("span",{children:e.jsx(Te,{})}),"  Watch Trailer"]}),G&&e.jsxs(o.a,{href:G,target:"_blank",rel:"noopener noreferrer",className:"trailer-button",animate:{opacity:1,y:0},whileTap:{scale:.8},children:[e.jsx("span",{children:e.jsx(Be,{})}),"  Download"]})]})]}),((q=(Y=a.similar)==null?void 0:Y.results)==null?void 0:q.length)>0&&e.jsxs(o.div,{className:"similar-movies",variants:n.fadeUp,children:[e.jsx("h2",{children:"Similar Movies"}),e.jsx("div",{className:"similar-list",children:a.similar.results.map(t=>{var Z,ee,te,ae,se,ie,re,oe,ne,le,ce,de,pe,me,he;const s=(ee=(Z=a.production_countries)==null?void 0:Z[0])==null?void 0:ee.iso_3166_1,c=((te=t.production_countries)==null?void 0:te.map(d=>d.iso_3166_1))||[];if(s&&!c.includes(s))return null;const p=(t.genre_ids||[]).filter(d=>(a.genres||[]).map(be=>be.id).includes(d)).length,h=1/(1+Math.abs((parseInt((ae=t.release_date)==null?void 0:ae.split("-")[0])||0)-(parseInt((se=a.release_date)==null?void 0:se.split("-")[0])||0))),v=((re=(ie=a.credits)==null?void 0:ie.cast)==null?void 0:re.slice(0,5).map(d=>d.id))||[],f=((ne=(oe=t.credits)==null?void 0:oe.cast)==null?void 0:ne.slice(0,5).map(d=>d.id))||[],x=v.filter(d=>f.includes(d)).length,m=(de=(ce=(le=a.credits)==null?void 0:le.crew)==null?void 0:ce.find(d=>d.job==="Director"))==null?void 0:de.id,g=(he=(me=(pe=t.credits)==null?void 0:pe.crew)==null?void 0:me.find(d=>d.job==="Director"))==null?void 0:he.id,k=m&&g&&m===g?1:0,b=a.title&&t.title&&t.title.toLowerCase().includes(a.title.toLowerCase())?1:0,$=(t.vote_average||0)/10,C=(t.popularity||0)/1e3,V=b*5+x*3+k*2,X=p*1.5+h+$+C;return{...t,relevanceScore:V+X,primaryRelevance:V,secondaryRelevance:X}}).filter(Boolean).sort((t,s)=>s.primaryRelevance===t.primaryRelevance?s.secondaryRelevance-t.secondaryRelevance:s.primaryRelevance-t.primaryRelevance).map(t=>e.jsxs(o.a,{className:"similar-movie",onClick:()=>u(`/movie/${t.id}`),variants:n.fadeUp,whileHover:{scale:1.03},whileTap:{scale:.97},children:[e.jsx(o.img,{src:t.poster_path?`${N}/w500${t.poster_path}`:"/default.png",alt:t.title,loading:"lazy",decoding:"async",variants:n.fadeUp}),e.jsx("span",{children:t.title})]},t.id))})]})]}),((Q=(J=a.credits)==null?void 0:J.cast)==null?void 0:Q.length)>0&&e.jsxs(o.div,{className:"movie-cast",variants:n.fadeUp,children:[e.jsx("h2",{children:"Cast"}),e.jsx("div",{className:"cast-list",children:a.credits.cast.map(t=>e.jsxs(o.a,{className:"cast-member",onClick:()=>u(`/cast/${t.id}`),variants:n.fadeUp,children:[e.jsx("img",{src:t.profile_path?`${N}/w500${t.profile_path}`:"/default.png",alt:t.name,loading:"lazy",decoding:"async"}),e.jsx("span",{children:t.name})]},t.id))})]})]}),e.jsx(Me,{children:L&&e.jsx(o.div,{className:"trailer-modal-overlay",onClick:U,variants:n.overlay,initial:"hidden",animate:"visible",exit:"exit",role:"dialog","aria-modal":"true",children:e.jsx(o.div,{className:"trailer-modal",onClick:t=>t.stopPropagation(),variants:n.modal(H.x-window.innerWidth/2,H.y-window.innerHeight/2),initial:"hidden",animate:"visible",exit:"exit",ref:ge,children:e.jsx("iframe",{width:"100%",height:"100%",src:`https://www.youtube.com/embed/${a.videos.results[0].key}?autoplay=1&rel=0`,title:`${a.title} Trailer`,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})})})})]})};export{Oe as default};
