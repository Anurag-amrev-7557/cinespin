import{o as K,r as a,u as H,j as e,H as U,A as f,m as c,I as Y}from"./index-DGnBJfx4.js";import{g as w,s as A}from"./cache-DJHUO1lX.js";import{c as z}from"./index-Cui47CSV.js";const F="92b98feaab02d1088661e456c19edb89",I="https://api.themoviedb.org/3",O="https://image.tmdb.org/t/p",R=()=>e.jsxs("div",{className:"skeleton-card",children:[e.jsx("div",{className:"skeleton-img"}),e.jsx("div",{className:"skeleton-title"})]}),Q=()=>{const{id:o}=K(),[i,C]=a.useState(null),[h,_]=a.useState([]),[N,L]=a.useState([]),[P,m]=a.useState(!0),[k,B]=a.useState(null),[u,y]=a.useState(!1),T=H(),[x,j]=a.useState(!1),[d,M]=a.useState("year"),[$,b]=a.useState("desc");a.useEffect(()=>{(async()=>{m(!0);const s=`cast-${o}`,r=`credits-${o}`,l=w(s),p=w(r);if(l&&p){C(l),_(p),m(!1);return}try{const[n,v]=await Promise.allSettled([fetch(`${I}/person/${o}?api_key=${F}`),fetch(`${I}/person/${o}/movie_credits?api_key=${F}`)]);if(n.status==="fulfilled"){const S=await n.value.json();C(S),A(s,S)}if(v.status==="fulfilled"){const D=(await v.value.json()).cast||[];_(D),A(r,D)}if(n.status==="rejected"||v.status==="rejected")throw new Error("Some details could not be fetched.")}catch(n){B(n.message)}finally{m(!1)}})()},[o]),a.useEffect(()=>{if(h.length>0){let t=[...h];const s=$==="asc"?1:-1;d==="year"?t.sort((r,l)=>{const p=r.release_date?parseInt(r.release_date.slice(0,4)):-1/0,n=l.release_date?parseInt(l.release_date.slice(0,4)):-1/0;return s*(p-n)}):d==="popularity"?t.sort((r,l)=>s*(l.popularity-r.popularity)):d==="rating"&&t.sort((r,l)=>s*(l.vote_average-r.vote_average)),L(t)}},[d,$,h]),a.useEffect(()=>{const t=s=>{u&&!s.target.closest(".filter-popup")&&!s.target.closest(".filter")&&y(!1),x&&!s.target.closest(".sort-popup")&&!s.target.closest(".sort")&&j(!1)};return document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}},[u,x]);const g=t=>{M(t),j(!1)},E=t=>{t==="filter1"?b("asc"):t==="filter2"&&b("desc"),y(!1)};return e.jsxs(e.Fragment,{children:[i&&e.jsxs(U,{children:[e.jsxs("title",{children:[i.name," - Cast Details"]}),e.jsx("meta",{name:"description",content:`Details about ${i.name}`})]}),e.jsx(f,{children:k&&e.jsx(c.div,{className:"cast-details-error",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs("p",{children:["Error: ",k]})})}),e.jsxs(c.div,{className:"cast-details-container",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[e.jsx("div",{className:"cast-info",children:i?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:i.profile_path?`${O}/original${i.profile_path}`:"/default.png",alt:i.name||"Profile image"}),e.jsxs("div",{children:[e.jsx("h1",{children:i.name}),e.jsx("p",{children:i.biography||"No biography available."})]})]}):e.jsx(R,{})}),e.jsxs("div",{className:"cast-movies",children:[e.jsxs("div",{className:"sorting-container",children:[e.jsx("div",{className:"filter",onClick:()=>y(t=>!t),"aria-label":"Toggle filter options",children:e.jsx(z,{})}),e.jsx("div",{className:"sort",onClick:()=>j(t=>!t),"aria-label":"Toggle sort options",children:e.jsx(Y,{})})]}),e.jsx(f,{children:u&&e.jsxs(c.div,{className:"popup-menu filter-popup",initial:{opacity:0,scale:.8,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:-10},transition:{type:"spring",stiffness:300,damping:30},children:[e.jsx("p",{onClick:()=>E("filter1"),children:"Descending Order"}),e.jsx("div",{className:"liner"}),e.jsx("p",{onClick:()=>E("filter2"),children:"Ascending Order"})]})}),e.jsx(f,{children:x&&e.jsxs(c.div,{className:"popup-menu sort-popup",initial:{opacity:0,scale:.8,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:-10},transition:{type:"spring",stiffness:300,damping:30},children:[e.jsx("p",{onClick:()=>g("year"),children:"Sort by Year"}),e.jsx("div",{className:"liner"}),e.jsx("p",{onClick:()=>g("popularity"),children:"Sort by Popularity"}),e.jsx("div",{className:"liner"}),e.jsx("p",{onClick:()=>g("rating"),children:"Sort by Rating"})]})}),e.jsx(f,{children:e.jsx(c.div,{layout:!0,className:"movie-list",children:P?Array.from({length:8}).map((t,s)=>e.jsx(R,{},s)):N.length===0?e.jsx("p",{children:"No credits found."}):N.map(t=>e.jsxs(c.a,{layout:!0,className:"movie-card",onClick:()=>T(`/movie/${t.id}`),initial:{opacity:0,y:30},animate:{opacity:1,y:0},exit:{opacity:0,y:30},transition:{duration:.5,ease:[.22,1,.36,1]},children:[e.jsx("img",{src:t.poster_path?`${O}/original${t.poster_path}`:"/default.png",alt:t.title||"Movie poster",loading:"lazy"}),e.jsx("span",{children:t.title})]},`${t.id}-${t.credit_id}`))})})]})]})]})};export{Q as default};
