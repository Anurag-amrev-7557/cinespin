import{r as s,j as e,m as t,L as me,A as K,d as q}from"./index-Cfv4M4VP.js";import{L as he,S as pe,M as ge,A as ue}from"./index-B-p5JYDh.js";import{F as xe,b as ve,c as je,d as ye,e as fe,a as Se}from"./index-CAl4AXoD.js";import{R as we,a as Ne,b as be}from"./index-CJsdpnYC.js";import{g as Ce,s as _e}from"./cache-DJHUO1lX.js";const J="92b98feaab02d1088661e456c19edb89",$e="https://api.themoviedb.org/3",Q="https://image.tmdb.org/t/p",Re=[{id:28,name:"Action",icon:e.jsx(he,{})},{id:35,name:"Comedy",icon:e.jsx(fe,{})},{id:18,name:"Drama",icon:e.jsx(Se,{})},{id:27,name:"Horror",icon:e.jsx(we,{})},{id:14,name:"Fantasy",icon:e.jsx(pe,{})},{id:878,name:"Sci‒Fi",icon:e.jsx(Ne,{})},{id:10751,name:"Family",icon:e.jsx(ge,{})},{id:10770,name:"Series",icon:e.jsx(ue,{})},{id:16,name:"Animation",icon:e.jsx(be,{})}],Fe=n=>n?n.length>200?n.substring(0,150)+"...":n:"",Me=()=>{var _,$,R,F,P,A;const[n,V]=s.useState(null),[v,h]=s.useState(null),[X,j]=s.useState(!1),Z=s.useRef(),p=s.useRef(null),[y,ee]=s.useState({x:0,y:0}),[f,ae]=s.useState(localStorage.getItem("region")||"Global"),[i,S]=s.useState(null),[g,w]=s.useState(!1),[ie,te]=s.useState(0),[N,b]=s.useState(1),se=()=>{if(p.current){const a=p.current.getBoundingClientRect();ee({x:a.left+a.width/2,y:a.top+a.height/2})}j(!0)},ne=()=>{j(!1)};s.useEffect(()=>{const a=()=>{ae(localStorage.getItem("region")||"Global")};return window.addEventListener("regionChange",a),()=>{window.removeEventListener("regionChange",a)}},[]);const C=async()=>{if(n){w(!0),h(null);try{const a=`random-${n}-page-${N}-${f}`,c=Ce(a);if(c){S(c),b(d=>d+1);return}let u=`${$e}/discover/movie?api_key=${J}&with_genres=${n}&page=${N}&${f==="India"?"&region=IN&with_original_language=hi":""}`;const l=await q.get(u);if(l.data.results.length===0){h("No movies found for this genre. Please try another genre.");return}const x=l.data.results[Math.floor(Math.random()*l.data.results.length)],m=await q.get(`https://api.themoviedb.org/3/movie/${x.id}?api_key=${J}&append_to_response=credits,videos,similar`);S(m.data),_e(a,m.data),b(d=>d+1)}catch(a){console.error("Error fetching content:",a),te(c=>c+1),ie<3?C():h("An error occurred while fetching content. Please try again later.")}finally{w(!1)}}},o={initial:{opacity:0,y:20},animate:{opacity:1,y:0,transition:{type:"spring",stiffness:300,damping:25,mass:1}},exit:{opacity:0,y:-20}};return e.jsxs(t.div,{className:"randomizer",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},...o,children:[e.jsxs(t.div,{className:"genres",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx("div",{className:"genre-title-container",children:e.jsxs("div",{className:"genre-title",children:["Genres",e.jsx("p",{children:"﹙Choose one genre﹚"})]})}),e.jsx(t.div,{className:"genre-container",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},...o,children:Re.map(a=>e.jsxs("div",{className:`genre-slide ${n===a.id?"selected":""}`,children:[e.jsx("input",{type:"radio",id:`genre-${a.id}`,checked:n===a.id,onChange:()=>V(a.id)}),e.jsx("label",{htmlFor:`genre-${a.id}`,"aria-label":`Select ${a.name} genre`,children:e.jsxs("div",{className:"genre",children:[e.jsx("div",{className:"genre-icon",children:a.icon}),a.name]})})]},a.id))})]}),e.jsx(t.button,{className:"randomizer-button",onClick:C,disabled:!n,initial:{scale:.8},animate:{scale:1},exit:{scale:.8},children:"Random Content"}),g&&e.jsx("div",{className:"movie-details-loading",children:"Loading... Please wait a moment..."}),v&&!g&&e.jsx("div",{className:"error-message",children:v}),i&&!g&&e.jsxs(t.div,{className:"content-display",...o,children:[e.jsxs("div",{className:"movie-content",children:[e.jsx(me,{to:`/movie/${i.id}`,children:e.jsx("picture",{children:e.jsx(t.img,{src:i.poster_path?`${Q}/original${i.poster_path}`:"/default.png",alt:i.title,className:"movie-poster",loading:"lazy",decoding:"async",...o})})}),e.jsxs(t.div,{className:"movie-info",...o,children:[e.jsx("h1",{children:i.title}),e.jsxs(t.div,{className:"movie-meta",...o,children:[e.jsxs("span",{children:[e.jsx(xe,{})," ",i.vote_average.toFixed(1)]}),e.jsxs("span",{children:[e.jsx(ve,{})," ",(_=i.release_date)==null?void 0:_.split("-")[0]]}),e.jsxs("span",{children:[e.jsx(je,{})," ",i.runtime," min"]}),e.jsxs("span",{children:[e.jsx(ye,{})," ",i.original_language.toUpperCase()]})]}),e.jsx(t.div,{className:"movie-genres",...o,children:i.genres.map(a=>e.jsx("span",{className:"genre-tag",children:a.name},a.id))}),e.jsxs(t.div,{className:"movie-overview",...o,children:[e.jsx("h2",{children:"Overview"}),e.jsx("p",{children:Fe(i.overview)}),((R=($=i.videos)==null?void 0:$.results)==null?void 0:R.length)>0&&e.jsx("button",{onClick:se,ref:p,className:"trailer-button",children:"▶  Watch Trailer"})]}),((F=i.similar)==null?void 0:F.results)&&i.similar.results.length>0&&e.jsxs(t.div,{className:"similar-movies",...o,children:[e.jsx("h2",{children:"Similar Movies"}),e.jsx(t.div,{className:"similar-list",...o,children:i.similar.results.map(a=>{var M,T,I,B,D,G,z,U,H,O,W,Y;const c=a.genre_ids.filter(r=>i.genres.map(de=>de.id).includes(r)).length,k=parseInt((M=a.release_date)==null?void 0:M.split("-")[0])||0,u=parseInt((T=i.release_date)==null?void 0:T.split("-")[0])||0,l=1/(1+Math.abs(u-k)),x=((B=(I=i.credits)==null?void 0:I.cast)==null?void 0:B.slice(0,5).map(r=>r.id))||[],m=((G=(D=a.credits)==null?void 0:D.cast)==null?void 0:G.slice(0,5).map(r=>r.id))||[],d=x.filter(r=>m.includes(r)).length,E=(H=(U=(z=i.credits)==null?void 0:z.crew)==null?void 0:U.find(r=>r.job==="Director"))==null?void 0:H.id,L=(Y=(W=(O=a.credits)==null?void 0:O.crew)==null?void 0:W.find(r=>r.job==="Director"))==null?void 0:Y.id,re=E&&L&&E===L?1:0,oe=(a.vote_average||0)/10,ce=(a.popularity||0)/1e3,le=c*2+l*2+d*1.5+re*3+oe*1.5+ce;return{...a,relevanceScore:le}}).sort((a,c)=>c.relevanceScore-a.relevanceScore).slice(0,9).map(a=>e.jsxs("a",{className:"similar-movie",href:`/movie/${a.id}`,children:[e.jsx("picture",{children:e.jsx("img",{src:a.poster_path?`${Q}/w500${a.poster_path}`:"/default.png",alt:a.title,loading:"lazy",decoding:"async"})}),e.jsx("span",{children:a.title})]},a.id))})]})]})]}),e.jsx(K,{children:X&&((A=(P=i==null?void 0:i.videos)==null?void 0:P.results)==null?void 0:A.length)>0&&e.jsx(K,{children:e.jsx(t.div,{className:"trailer-modal-overlay",onClick:ne,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},role:"dialog","aria-modal":"true",children:e.jsx(t.div,{className:"trailer-modal",onClick:a=>a.stopPropagation(),initial:{scale:.5,opacity:0,x:y.x-window.innerWidth,y:y.y-window.innerHeight},animate:{scale:1,opacity:1,x:0,y:0},exit:{scale:.5,opacity:0},transition:{duration:.3,ease:"easeOut"},ref:Z,children:e.jsx("iframe",{width:"100%",height:"100%",src:`https://www.youtube.com/embed/${i.videos.results[0].key}?autoplay=1&rel=0`,title:`${i.title} Trailer`,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})})})})})]})]})};export{Me as default};
