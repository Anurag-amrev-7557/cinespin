import{r as i,j as s,u as q,a as J,m as u,A as T,c as Q}from"./index-Cfv4M4VP.js";import{L as X,S as Z,M as ee,A as se}from"./index-B-p5JYDh.js";import{F as te,a as ae}from"./index-CAl4AXoD.js";import{c as ie,R as re,a as ne,b as oe}from"./index-CJsdpnYC.js";import{g as le,s as ce}from"./cache-DJHUO1lX.js";import{I as de}from"./index-CNDOlL8G.js";const ge="92b98feaab02d1088661e456c19edb89",f=[{id:28,name:"Action",icon:s.jsx(X,{})},{id:35,name:"Comedy",icon:s.jsx(Q,{})},{id:18,name:"Drama",icon:s.jsx(ae,{})},{id:27,name:"Horror",icon:s.jsx(re,{})},{id:14,name:"Fantasy",icon:s.jsx(Z,{})},{id:878,name:"SciFi",icon:s.jsx(ne,{})},{id:10751,name:"Family",icon:s.jsx(ee,{})},{id:10770,name:"Series",icon:s.jsx(se,{})},{id:16,name:"Animation",icon:s.jsx(oe,{})}],pe=()=>s.jsxs("div",{className:"skeleton-genre-card",children:[s.jsx("div",{className:"skeleton-genre-icon"}),s.jsx("div",{className:"skeleton-genre-title"})]}),ve=()=>{const[n,P]=i.useState(()=>parseInt(localStorage.getItem("genre"))||f[0].id),[x,j]=i.useState([]),[S,N]=i.useState(1),[O,D]=i.useState(!0),[p,_]=i.useState(()=>localStorage.getItem("region")||"Global"),[B,A]=i.useState(!0),[l,d]=i.useState(1),[L,w]=i.useState(1),[k,F]=i.useState(!1),[C,E]=i.useState(!1),[y,H]=i.useState("year"),[$,M]=i.useState("desc"),[U,K]=i.useState([]),I=q(),R=J();i.useEffect(()=>{const e=new URLSearchParams(R.search),t=parseInt(e.get("genre"),10),a=parseInt(e.get("page"),10),r=t||f[0].id,g=a||1;P(r),d(g),o(r,g)},[R.search]);const Y=e=>{e!==n&&(localStorage.setItem("genre",e),localStorage.setItem("currentPage",l),P(e),I(`/movies?genre=${e}&page=${l}`),o(e,l))},o=async(e=0,t=1)=>{A(!0);const a=typeof e=="number"&&!isNaN(e)?e:0,r=typeof t=="number"&&t>0?t:1,g=`genre-${a}-page-${r}-region-${p}`;try{const c=le(g);if(c&&Array.isArray(c.results)){j(c.results);const h=parseInt((c||m).total_pages,10);N(!isNaN(h)&&h>0?h:1),r>h?d(1):d(r),w(Math.floor((r-1)/5)*5+1);return}const z=p==="India"?"&region=IN&with_original_language=hi":"",V=a&&a!==0?`&with_genres=${a}`:"",W=`https://api.themoviedb.org/3/discover/movie?api_key=${ge}${V}&page=${r}${z}`,v=await fetch(W);if(!v.ok){const h=`TMDB API error: ${v.status} ${v.statusText}`;throw new Error(h)}const m=await v.json();if(!Array.isArray(m.results))throw new Error("Invalid data structure from TMDB API.");j(m.results),N(Number.isInteger(m.total_pages)?m.total_pages:1),d(r),localStorage.setItem("currentPage",r),w(Math.floor((r-1)/5)*5+1),I(`/movies?genre=${a}&page=${r}`,{replace:!0}),ce(g,m)}catch(c){console.error("Error fetching movies:",c),j([]),N(1),d(1),w(1)}finally{A(!1)}};i.useEffect(()=>{o(n,1)},[p]),i.useEffect(()=>{const e=()=>{const t=localStorage.getItem("region")||"Global";t!==p&&(_(t),d(1),localStorage.setItem("currentPage",1),o(n,1))};return window.addEventListener("regionChange",e),window.addEventListener("storage",e),()=>{window.removeEventListener("regionChange",e),window.removeEventListener("storage",e)}},[n,p]),i.useEffect(()=>{const e=t=>{if(t.key==="region"){const a=t.newValue||"Global";_(a),d(1),localStorage.setItem("currentPage",1),o(n,1)}};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}},[n,o]),i.useEffect(()=>{if(x.length>0){let e=[...x];const t=$==="asc"?1:-1;y==="year"?e.sort((a,r)=>{const g=a.release_date?parseInt(a.release_date.slice(0,4)):-1/0,c=r.release_date?parseInt(r.release_date.slice(0,4)):-1/0;return t*(g-c)}):y==="popularity"?e.sort((a,r)=>t*(r.popularity-a.popularity)):y==="rating"&&e.sort((a,r)=>t*(r.vote_average-a.vote_average)),K(e)}},[y,$,x]),i.useEffect(()=>{const e=t=>{k&&!t.target.closest(".filter-popup")&&!t.target.closest(".filter")&&F(!1),C&&!t.target.closest(".sort-popup")&&!t.target.closest(".sort")&&E(!1)};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[k,C]);const b=e=>{H(e),E(!1)},G=e=>{e==="filter1"?M("asc"):e==="filter2"&&M("desc"),F(!1)};return i.useEffect(()=>{o(n,1)},[n,p]),i.useEffect(()=>{D(!1)},[]),s.jsxs("div",{className:"movies-container",children:[s.jsx(u.div,{className:"genre-container",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.3,ease:"easeOut",delay:.2},children:!f.length||O?Array.from({length:f.length||9},(e,t)=>s.jsx("div",{className:"genre-slide",children:s.jsx(pe,{})},t)):f.map(e=>s.jsx("div",{className:"genre-slide",children:s.jsxs("div",{className:`genre ${n===e.id?"active":""}`,onClick:()=>Y(e.id),children:[s.jsx("div",{className:"genre-icon",children:e.icon}),e.name]})},e.id))}),s.jsxs("div",{className:"movies-list",children:[s.jsxs("div",{className:"sorting-container",children:[s.jsx("div",{className:"filter",onClick:()=>F(e=>!e),"aria-label":"Toggle filter options",children:s.jsx(ie,{})}),s.jsx("div",{className:"sort",onClick:()=>E(e=>!e),"aria-label":"Toggle sort options",children:s.jsx(de,{})})]}),s.jsx(T,{children:k&&s.jsxs(u.div,{className:"popup-menu filter-popup",initial:{opacity:0,scale:.8,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:-10},transition:{type:"spring",stiffness:300,damping:30},children:[s.jsx("p",{onClick:()=>G("filter1"),children:"Ascending Order"}),s.jsx("div",{className:"liner"}),s.jsx("p",{onClick:()=>G("filter2"),children:"Descending Order"})]})}),s.jsx(T,{children:C&&s.jsxs(u.div,{className:"popup-menu sort-popup",initial:{opacity:0,scale:.8,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:-10},transition:{type:"spring",stiffness:300,damping:30},children:[s.jsx("p",{onClick:()=>b("year"),children:"Sort by Year"}),s.jsx("div",{className:"liner"}),s.jsx("p",{onClick:()=>b("popularity"),children:"Sort by Popularity"}),s.jsx("div",{className:"liner"}),s.jsx("p",{onClick:()=>b("rating"),children:"Sort by Rating"})]})}),B?s.jsx("div",{className:"loading"}):s.jsx("div",{className:"movie-grid",children:U.map((e,t)=>{var a;return s.jsxs(u.div,{className:"movie-card",onClick:()=>I(`/movie/${e.id}`),initial:{opacity:0,y:30,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:30,scale:.95},whileHover:{scale:1,y:-5},transition:{duration:.7,ease:[.4,0,.2,1]},children:[s.jsx("picture",{children:s.jsx("img",{loading:"lazy",decoding:"async",src:e.poster_path?`https://image.tmdb.org/t/p/w500${e.poster_path}`:"/default.png",alt:e.title,className:"movie-poster"})}),s.jsx("span",{className:"movie-title",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e.title.split(" ").slice(0,3).join(" ")}),s.jsxs("div",{className:"movie-details",children:[s.jsxs("span",{children:[s.jsx(te,{className:"movie-star"})," ",e.vote_average.toFixed(1)]}),s.jsx("span",{className:"gap",children:" 〡 "}),s.jsx("span",{children:(a=e.release_date)==null?void 0:a.split("-")[0]}),e.runtime&&s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"gap",children:" 〡 "}),s.jsxs("span",{children:[e.runtime," min"]})]})]})]},e.id)})}),(S>1||x.length>0)&&s.jsxs("div",{className:"pagination-controls",children:[s.jsx("button",{onClick:()=>o(n,l-1),disabled:l===1,children:"Prev"}),[...Array(Math.min(5,S-L+1))].map((e,t)=>{const a=L+t;return s.jsx(u.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>o(n,a),className:l===a?"active-page":"",children:a},a)}),s.jsx("button",{onClick:()=>o(n,l+1),disabled:l>=S,children:"Next"})]})]})]})};export{ve as default};
