import{G as we,o as xe,u as je,a as _e,r as n,j as e,m as r,H as be,c as ke,g as $e,h as Ce,i as Ne,p as Re,A as Ue}from"./index-BpWArnGf.js";import{g as De,s as ce}from"./cache-DJHUO1lX.js";import{m as de}from"./movieDownloadLinks-_kJNLVWA.js";import{s as Le}from"./MovieDetails-4dli7IQi.js";function Ee(l){return we({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"},child:[]},{tag:"polyline",attr:{points:"7 10 12 15 17 10"},child:[]},{tag:"line",attr:{x1:"12",y1:"15",x2:"12",y2:"3"},child:[]}]})(l)}const g="92b98feaab02d1088661e456c19edb89",w="https://api.themoviedb.org/3",N="https://image.tmdb.org/t/p",pe=(l,u=200)=>l&&l.length>u?l.slice(0,u)+"...":l||"",Be=()=>{var F,A,W,H,G,O,K;const{id:l}=xe(),u=je(),D=_e(),L=n.useMemo(()=>new URLSearchParams(D.search),[D.search]).get("page")||1,me=n.useRef(null),E=n.useRef(null),[t,j]=n.useState(null),[S,he]=n.useState(null),[ue,T]=n.useState(!0),[M,ve]=n.useState(null),[R,P]=n.useState(!1),[I,fe]=n.useState({x:0,y:0}),_=n.useMemo(()=>`movie-details-${l}`,[l]),ye=()=>{var a,i,c,p;if(window.innerWidth<=450){const s=(c=(i=(a=t==null?void 0:t.videos)==null?void 0:a.results)==null?void 0:i[0])==null?void 0:c.key;if(s){const h=`youtube://www.youtube.com/watch?v=${s}`,v=`https://www.youtube.com/watch?v=${s}`,f=window.open(h,"_blank");setTimeout(()=>{f&&(f.location.href=v)},500)}}else{const s=(p=E.current)==null?void 0:p.getBoundingClientRect();s&&fe({x:s.left+s.width/2,y:s.top+s.height/2}),P(!0)}},U=n.useCallback(()=>P(!1),[]);n.useEffect(()=>{const a=i=>i.key==="Escape"&&U();return R&&document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[R,U]),n.useEffect(()=>{const a=setTimeout(()=>{document.body.style.background="black"},1e3);return()=>{clearTimeout(a),document.body.style.background=""}},[]),n.useEffect(()=>{window.scrollTo(0,0)},[]),n.useEffect(()=>{(async()=>{var c;const i=De(_);if(i){setTimeout(()=>{j(i),T(!1)},200);return}try{const p=await fetch(`${w}/movie/${l}?api_key=${g}&append_to_response=credits,videos`);if(!p.ok)throw new Error("Failed to fetch movie details");const s=await p.json();if(j(s),(c=s.belongs_to_collection)!=null&&c.id)try{const v=await(await fetch(`${w}/collection/${s.belongs_to_collection.id}?api_key=${g}`)).json(),x=(await Promise.all((v.parts||[]).filter(m=>m.id!==s.id).map(async m=>await(await fetch(`${w}/movie/${m.id}?api_key=${g}&append_to_response=credits`)).json()))).filter(m=>m.release_date).sort((m,y)=>{var $,C;const b=parseInt(($=m.release_date)==null?void 0:$.split("-")[0])||0,k=parseInt((C=y.release_date)==null?void 0:C.split("-")[0])||0;return b===k?(y.vote_average||0)-(m.vote_average||0):k-b});s.similar={results:x},j({...s}),ce(_,{...s});return}catch(h){console.error("Failed to fetch collection parts:",h)}try{const v=await(await fetch(`${w}/movie/${l}/similar?api_key=${g}`)).json(),f=await Promise.all((v.results||[]).slice(0,10).map(async x=>await(await fetch(`${w}/movie/${x.id}?api_key=${g}&append_to_response=credits`)).json()));s.similar={results:f},j({...s}),ce(_,{...s})}catch(h){console.error("Error fetching similar movies with details:",h)}}catch(p){ve(p.message)}finally{T(!1)}})()},[_]),n.useEffect(()=>{(async()=>{try{const c=await(await fetch(`${w}/movie/${l}/images?api_key=${g}&include_image_language=en,null`)).json(),p=c.logos.find(s=>s.file_path.endsWith(".webp"))||c.logos[0];p&&he(`${N}/original${p.file_path}`)}catch(i){console.error("Error fetching logo:",i)}})()},[l]);const B=n.useMemo(()=>{const a=Object.keys(de).find(i=>{var c;return i.toLowerCase().trim()===((c=t==null?void 0:t.title)==null?void 0:c.toLowerCase().trim())});return a?de[a]:null},[t]);n.useMemo(()=>(t==null?void 0:t.title)&&Le[t.title],[t]);const o={container:{hidden:{},visible:{transition:{staggerChildren:.1,delayChildren:.3}}},fadeUp:{hidden:{opacity:0,y:30},visible:{opacity:1,y:0,transition:{type:"spring",stiffness:300,damping:24}},exit:{opacity:0,y:-20,transition:{duration:.3}}},overlay:{hidden:{opacity:0},visible:{opacity:1,transition:{duration:.4}},exit:{opacity:0,transition:{duration:.3}}},modal:(a,i)=>({hidden:{scale:.7,opacity:0,x:a,y:i},visible:{scale:1,opacity:1,x:0,y:0,transition:{type:"spring",stiffness:400,damping:25}},exit:{scale:.7,opacity:0,transition:{duration:.3,ease:"easeInOut"}}})};return ue||!t?e.jsx("div",{className:"movie-details-loading",children:e.jsx("div",{className:"loader","aria-live":"assertive",role:"alert"})}):M?e.jsx("div",{className:"movie-details-error",children:e.jsxs("p",{children:["Error: ",M]})}):e.jsxs(r.div,{className:"movie-details-container",variants:o.container,initial:"hidden",animate:"visible",exit:"exit",children:[e.jsxs(be,{children:[e.jsxs("title",{children:[t.title," - Movie Details"]}),e.jsx("meta",{name:"description",content:pe(t.overview)})]}),e.jsx(r.div,{className:"movie-details-overlay",style:{backgroundImage:`url(${N}/original${t.backdrop_path})`},decoding:"async",variants:o.fadeUp,children:e.jsx("div",{className:"backdrop-overlay"})}),e.jsxs(r.div,{className:"movie-content",variants:o.fadeUp,children:[e.jsxs(r.div,{className:"movie-info",variants:o.fadeUp,children:[e.jsx(r.h1,{variants:o.fadeUp,children:S?e.jsx("img",{src:S,alt:"Movie Logo",className:"movie-title"}):t.title}),e.jsxs("div",{className:"movie-meta",children:[e.jsxs(r.span,{variants:o.fadeUp,children:[e.jsx(ke,{})," ",t.vote_average.toFixed(1)]}),e.jsxs(r.span,{variants:o.fadeUp,children:[e.jsx($e,{})," ",(F=t.release_date)==null?void 0:F.split("-")[0]]}),t.runtime&&e.jsxs(r.span,{variants:o.fadeUp,children:[e.jsx(Ce,{})," ",Math.floor(t.runtime/60),"h ",t.runtime%60,"m"]}),e.jsxs(r.span,{variants:o.fadeUp,children:[e.jsx(Ne,{})," ",t.original_language.toUpperCase()]})]}),e.jsx(r.div,{className:"movie-genres",variants:o.fadeUp,children:t.genres.map(a=>e.jsx(r.div,{className:"genre-tag",role:"button",tabIndex:0,onClick:()=>u(`/movies?genre=${a.id}&page=${L}`),onKeyDown:i=>{i.key==="Enter"&&u(`/movies?genre=${a.id}&page=${L}`)},whileHover:{scale:1.05},whileTap:{scale:.95},children:a.name},a.id))}),e.jsxs(r.div,{className:"movie-overview",variants:o.fadeUp,children:[e.jsx("h2",{children:"Overview"}),e.jsx("p",{children:pe(t.overview)}),e.jsxs("div",{className:"download-container",children:[((W=(A=t.videos)==null?void 0:A.results)==null?void 0:W.length)>0&&e.jsxs(r.a,{onClick:ye,ref:E,className:"trailer-button",animate:{opacity:1,y:0},whileTap:{scale:.8},children:[e.jsx("span",{children:e.jsx(Re,{})}),"  Watch Trailer"]}),B&&e.jsxs(r.a,{href:B,target:"_blank",rel:"noopener noreferrer",className:"trailer-button",animate:{opacity:1,y:0},whileTap:{scale:.8},children:[e.jsx("span",{children:e.jsx(Ee,{})}),"  Download"]})]})]}),((G=(H=t.similar)==null?void 0:H.results)==null?void 0:G.length)>0&&e.jsxs(r.div,{className:"similar-movies",variants:o.fadeUp,children:[e.jsx("h2",{children:"Similar Movies"}),e.jsx("div",{className:"similar-list",children:t.similar.results.map(a=>{var q,J,Q,V,X,Z,ee,ae,te,ie,se,re,oe,ne,le;const i=(J=(q=t.production_countries)==null?void 0:q[0])==null?void 0:J.iso_3166_1,c=((Q=a.production_countries)==null?void 0:Q.map(d=>d.iso_3166_1))||[];if(i&&!c.includes(i))return null;const p=(a.genre_ids||[]).filter(d=>(t.genres||[]).map(ge=>ge.id).includes(d)).length,h=1/(1+Math.abs((parseInt((V=a.release_date)==null?void 0:V.split("-")[0])||0)-(parseInt((X=t.release_date)==null?void 0:X.split("-")[0])||0))),v=((ee=(Z=t.credits)==null?void 0:Z.cast)==null?void 0:ee.slice(0,5).map(d=>d.id))||[],f=((te=(ae=a.credits)==null?void 0:ae.cast)==null?void 0:te.slice(0,5).map(d=>d.id))||[],x=v.filter(d=>f.includes(d)).length,m=(re=(se=(ie=t.credits)==null?void 0:ie.crew)==null?void 0:se.find(d=>d.job==="Director"))==null?void 0:re.id,y=(le=(ne=(oe=a.credits)==null?void 0:oe.crew)==null?void 0:ne.find(d=>d.job==="Director"))==null?void 0:le.id,b=m&&y&&m===y?1:0,k=t.title&&a.title&&a.title.toLowerCase().includes(t.title.toLowerCase())?1:0,$=(a.vote_average||0)/10,C=(a.popularity||0)/1e3,z=k*5+x*3+b*2,Y=p*1.5+h+$+C;return{...a,relevanceScore:z+Y,primaryRelevance:z,secondaryRelevance:Y}}).filter(Boolean).sort((a,i)=>i.primaryRelevance===a.primaryRelevance?i.secondaryRelevance-a.secondaryRelevance:i.primaryRelevance-a.primaryRelevance).map(a=>e.jsxs(r.a,{className:"similar-movie",onClick:()=>u(`/movie/${a.id}`),variants:o.fadeUp,whileHover:{scale:1.03},whileTap:{scale:.97},children:[e.jsx(r.img,{src:a.poster_path?`${N}/w500${a.poster_path}`:"/default.png",alt:a.title,loading:"lazy",decoding:"async",variants:o.fadeUp}),e.jsx("span",{children:a.title})]},a.id))})]})]}),((K=(O=t.credits)==null?void 0:O.cast)==null?void 0:K.length)>0&&e.jsxs(r.div,{className:"movie-cast",variants:o.fadeUp,children:[e.jsx("h2",{children:"Cast"}),e.jsx("div",{className:"cast-list",children:t.credits.cast.map(a=>e.jsxs(r.a,{className:"cast-member",onClick:()=>u(`/cast/${a.id}`),variants:o.fadeUp,children:[e.jsx("img",{src:a.profile_path?`${N}/w500${a.profile_path}`:"/default.png",alt:a.name,loading:"lazy",decoding:"async"}),e.jsx("span",{children:a.name})]},a.id))})]})]}),e.jsx(Ue,{children:R&&e.jsx(r.div,{className:"trailer-modal-overlay",onClick:U,variants:o.overlay,initial:"hidden",animate:"visible",exit:"exit",role:"dialog","aria-modal":"true",children:e.jsx(r.div,{className:"trailer-modal",onClick:a=>a.stopPropagation(),variants:o.modal(I.x-window.innerWidth/2,I.y-window.innerHeight/2),initial:"hidden",animate:"visible",exit:"exit",ref:me,children:e.jsx("iframe",{width:"100%",height:"100%",src:`https://www.youtube.com/embed/${t.videos.results[0].key}?autoplay=1&rel=0`,title:`${t.title} Trailer`,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})})})})]})};export{Be as default};
