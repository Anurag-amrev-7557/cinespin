import{o as ye,u as we,a as xe,r as o,j as a,m as i,H as je,c as _e,g as be,i as $e,h as ke,A as Ce}from"./index-DGnBJfx4.js";import{a as Ne}from"./index-Bc44HBA4.js";import{g as Re,s as le}from"./cache-DJHUO1lX.js";import{m as ce}from"./movieDownloadLinks-_kJNLVWA.js";import{s as Ue}from"./MovieDetails-4dli7IQi.js";const f="92b98feaab02d1088661e456c19edb89",g="https://api.themoviedb.org/3",N="https://image.tmdb.org/t/p",de=(d,h=200)=>d&&d.length>h?d.slice(0,h)+"...":d||"",Pe=()=>{var F,H,A,W,z,O;const{id:d}=ye(),h=we(),S=xe(),E=o.useMemo(()=>new URLSearchParams(S.search),[S.search]).get("page")||1,pe=o.useRef(null),L=o.useRef(null),[t,x]=o.useState(null),[D,me]=o.useState(null),[he,T]=o.useState(!0),[M,ve]=o.useState(null),[R,P]=o.useState(!1),[B,ue]=o.useState({x:0,y:0}),j=o.useMemo(()=>`movie-details-${d}`,[d]),fe=()=>{var s;const e=(s=L.current)==null?void 0:s.getBoundingClientRect();e&&ue({x:e.left+e.width/2,y:e.top+e.height/2}),P(!0)},U=o.useCallback(()=>P(!1),[]);o.useEffect(()=>{const e=s=>s.key==="Escape"&&U();return R&&document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[R,U]),o.useEffect(()=>{const e=setTimeout(()=>{document.body.style.background="black"},1e3);return()=>{clearTimeout(e),document.body.style.background=""}},[]),o.useEffect(()=>{window.scrollTo(0,0)},[]),o.useEffect(()=>{(async()=>{var p;const s=Re(j);if(s){setTimeout(()=>{x(s),T(!1)},200);return}try{const m=await fetch(`${g}/tv/${d}?api_key=${f}&append_to_response=credits,videos`);if(!m.ok)throw new Error("Failed to fetch movie details");const n=await m.json();if(x(n),(p=n.belongs_to_collection)!=null&&p.id)try{const y=await(await fetch(`${g}/collection/${n.belongs_to_collection.id}?api_key=${f}`)).json(),w=(await Promise.all((y.parts||[]).filter(c=>c.id!==n.id).map(async c=>await(await fetch(`${g}/tv/${c.id}?api_key=${f}&append_to_response=credits`)).json()))).filter(c=>c.release_date).sort((c,u)=>{var k,C;const b=parseInt((k=c.release_date)==null?void 0:k.split("-")[0])||0,$=parseInt((C=u.release_date)==null?void 0:C.split("-")[0])||0;return b===$?(u.vote_average||0)-(c.vote_average||0):$-b});n.similar={results:w},x({...n}),le(j,{...n});return}catch(v){console.error("Failed to fetch collection parts:",v)}try{const y=await(await fetch(`${g}/tv/${d}/similar?api_key=${f}`)).json(),_=await Promise.all((y.results||[]).slice(0,10).map(async w=>await(await fetch(`${g}/tv/${w.id}?api_key=${f}&append_to_response=credits,videos`)).json()));n.similar={results:_},x({...n}),le(j,{...n})}catch(v){console.error("Error fetching similar movies with details:",v)}}catch(m){ve(m.message)}finally{T(!1)}})()},[j]),o.useEffect(()=>{(async()=>{try{const p=await(await fetch(`${g}/tv/${d}/images?api_key=${f}&include_image_language=en,null`)).json(),m=p.logos.find(n=>n.file_path.endsWith(".webp"))||p.logos[0];m&&me(`${N}/original${m.file_path}`)}catch(s){console.error("Error fetching logo:",s)}})()},[d]);const I=o.useMemo(()=>{const e=Object.keys(ce).find(s=>{var p;return s.toLowerCase().trim()===((p=t==null?void 0:t.title)==null?void 0:p.toLowerCase().trim())});return e?ce[e]:null},[t]);o.useMemo(()=>(t==null?void 0:t.title)&&Ue[t.title],[t]);const r={container:{hidden:{},visible:{transition:{staggerChildren:.1,delayChildren:.3}}},fadeUp:{hidden:{opacity:0,y:30},visible:{opacity:1,y:0,transition:{type:"spring",stiffness:300,damping:24}},exit:{opacity:0,y:-20,transition:{duration:.3}}},overlay:{hidden:{opacity:0},visible:{opacity:1,transition:{duration:.4}},exit:{opacity:0,transition:{duration:.3}}},modal:(e,s)=>({hidden:{scale:.7,opacity:0,x:e,y:s},visible:{scale:1,opacity:1,x:0,y:0,transition:{type:"spring",stiffness:400,damping:25}},exit:{scale:.7,opacity:0,transition:{duration:.3,ease:"easeInOut"}}})};return he||!t?a.jsx("div",{className:"movie-details-loading",children:a.jsx("div",{className:"loader","aria-live":"assertive",role:"alert"})}):M?a.jsx("div",{className:"movie-details-error",children:a.jsxs("p",{children:["Error: ",M]})}):a.jsxs(i.div,{className:"movie-details-container",variants:r.container,initial:"hidden",animate:"visible",exit:"exit",children:[a.jsxs(je,{children:[a.jsxs("title",{children:[t.name," - Series Details"]}),a.jsx("meta",{name:"description",content:de(t.overview)})]}),a.jsx(i.div,{className:"movie-details-overlay",style:{backgroundImage:`url(${N}/original${t.backdrop_path})`},decoding:"async",variants:r.fadeUp,children:a.jsx("div",{className:"backdrop-overlay"})}),a.jsxs(i.div,{className:"movie-content",variants:r.fadeUp,children:[a.jsxs(i.div,{className:"movie-info",variants:r.fadeUp,children:[a.jsx(i.h1,{variants:r.fadeUp,children:D?a.jsx("img",{src:D,alt:"Movie Logo",className:"movie-title"}):t.title}),a.jsxs("div",{className:"movie-meta",children:[a.jsxs(i.span,{variants:r.fadeUp,children:[a.jsx(_e,{})," ",t.vote_average.toFixed(1)]}),a.jsxs(i.span,{variants:r.fadeUp,children:[a.jsx(be,{})," ",(t.first_air_date||t.release_date||"").split("-")[0]]}),a.jsxs(i.span,{variants:r.fadeUp,children:[a.jsx($e,{})," ",t.original_language.toUpperCase()]}),t.number_of_seasons!==void 0&&a.jsxs(i.span,{variants:r.fadeUp,style:{display:"flex",alignItems:"center"},children:[a.jsx("svg",{stroke:"currentColor",fill:"currentColor",strokeWidth:"0",viewBox:"0 0 640 512",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:a.jsx("path",{d:"M592 0H48A48 48 0 0 0 0 48v320a48 48 0 0 0 48 48h240v32H112a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16H352v-32h240a48 48 0 0 0 48-48V48a48 48 0 0 0-48-48zm-16 352H64V64h512z"})})," ",t.number_of_seasons," Season",t.number_of_seasons>1?"s":""]}),t.runtime&&a.jsxs(i.span,{variants:r.fadeUp,children:[a.jsx(ke,{})," ",Math.floor(t.runtime/60),"h ",t.runtime%60,"m"]})]}),a.jsx(i.div,{className:"movie-genres",variants:r.fadeUp,children:t.genres.map(e=>a.jsx(i.div,{className:"genre-tag",role:"button",tabIndex:0,onClick:()=>h(`/series?genre=${e.id}&page=${E}`),onKeyDown:s=>{s.key==="Enter"&&h(`/series?genre=${e.id}&page=${E}`)},whileHover:{scale:1.05},whileTap:{scale:.95},children:e.name},e.id))}),a.jsxs(i.div,{className:"movie-overview",variants:r.fadeUp,children:[a.jsx("h2",{children:"Overview"}),a.jsx("p",{children:de(t.overview)}),a.jsxs("div",{className:"download-container",children:[((H=(F=t.videos)==null?void 0:F.results)==null?void 0:H.length)>0&&a.jsx(i.button,{onClick:fe,ref:L,className:"trailer-button",animate:{opacity:1,y:0},whileTap:{scale:.8},children:"▶  Watch Trailer"}),I&&a.jsxs(i.a,{href:I,target:"_blank",rel:"noopener noreferrer",className:"trailer-button download-button",animate:{opacity:1,y:0},whileTap:{scale:.8},children:[a.jsx(Ne,{}),"  Download"]})]})]}),((W=(A=t.similar)==null?void 0:A.results)==null?void 0:W.length)>0&&a.jsxs(i.div,{className:"similar-movies",variants:r.fadeUp,children:[a.jsx("h2",{children:"Similar Movies"}),a.jsx("div",{className:"similar-list",children:t.similar.results.map(e=>{var V,Y,q,J,Q,X,Z,ee,ae,te,se,ie,re,oe,ne;const s=(Y=(V=t.production_countries)==null?void 0:V[0])==null?void 0:Y.iso_3166_1,p=((q=e.production_countries)==null?void 0:q.map(l=>l.iso_3166_1))||[];if(s&&!p.includes(s))return null;const m=(e.genre_ids||[]).filter(l=>(t.genres||[]).map(ge=>ge.id).includes(l)).length,v=1/(1+Math.abs((parseInt((J=e.release_date)==null?void 0:J.split("-")[0])||0)-(parseInt((Q=t.release_date)==null?void 0:Q.split("-")[0])||0))),y=((Z=(X=t.credits)==null?void 0:X.cast)==null?void 0:Z.slice(0,5).map(l=>l.id))||[],_=((ae=(ee=e.credits)==null?void 0:ee.cast)==null?void 0:ae.slice(0,5).map(l=>l.id))||[],w=y.filter(l=>_.includes(l)).length,c=(ie=(se=(te=t.credits)==null?void 0:te.crew)==null?void 0:se.find(l=>l.job==="Director"))==null?void 0:ie.id,u=(ne=(oe=(re=e.credits)==null?void 0:re.crew)==null?void 0:oe.find(l=>l.job==="Director"))==null?void 0:ne.id,b=c&&u&&c===u?1:0,$=t.title&&e.title&&e.title.toLowerCase().includes(t.title.toLowerCase())?1:0,k=(e.vote_average||0)/10,C=(e.popularity||0)/1e3,K=$*5+w*3+b*2,G=m*1.5+v+k+C;return{...e,relevanceScore:K+G,primaryRelevance:K,secondaryRelevance:G}}).filter(Boolean).sort((e,s)=>s.primaryRelevance===e.primaryRelevance?s.secondaryRelevance-e.secondaryRelevance:s.primaryRelevance-e.primaryRelevance).map(e=>a.jsxs(i.a,{className:"similar-movie",onClick:()=>h(`/movie/${e.id}`),variants:r.fadeUp,whileHover:{scale:1.03},whileTap:{scale:.97},children:[a.jsx(i.img,{src:e.poster_path?`${N}/w500${e.poster_path}`:"/default.png",alt:e.title,loading:"lazy",decoding:"async",variants:r.fadeUp}),a.jsx("span",{children:e.title})]},`${e.id}-${e.first_air_date||""}-${Math.random()}`))})]})]}),((O=(z=t.credits)==null?void 0:z.cast)==null?void 0:O.length)>0&&a.jsxs(i.div,{className:"movie-cast",variants:r.fadeUp,children:[a.jsx("h2",{children:"Cast"}),a.jsx("div",{className:"cast-list",children:t.credits.cast.map(e=>a.jsxs(i.a,{className:"cast-member",onClick:()=>h(`/cast/${e.id}`),variants:r.fadeUp,children:[a.jsx("img",{src:e.profile_path?`${N}/w500${e.profile_path}`:"/default.png",alt:e.name,loading:"lazy",decoding:"async"}),a.jsx("span",{children:e.name})]},e.id))})]})]}),a.jsx(Ce,{children:R&&a.jsx(i.div,{className:"trailer-modal-overlay",onClick:U,variants:r.overlay,initial:"hidden",animate:"visible",exit:"exit",role:"dialog","aria-modal":"true",children:a.jsx(i.div,{className:"trailer-modal",onClick:e=>e.stopPropagation(),variants:r.modal(B.x-window.innerWidth/2,B.y-window.innerHeight/2),initial:"hidden",animate:"visible",exit:"exit",ref:pe,children:a.jsx("iframe",{width:"100%",height:"100%",src:`https://www.youtube.com/embed/${t.videos.results[0].key}?autoplay=1&rel=0`,title:`${t.title} Trailer`,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})})})})]})};export{Pe as default};
